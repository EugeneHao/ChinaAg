lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + year + region ,
data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn) + year + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) +  I(sbsd_soybean - sbsd_corn) + year +region,
data = regdat %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + year + region,
data = regdat %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn) + year + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) +  I(sbsd_soybean - sbsd_corn) + year +region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + year + region ,
data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
summary(regdat$subsidy_corn)
view(regdat)
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_corn  + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + policy  +region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + policy  + region, data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn) + market_reg_corn + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + market_reg_corn + region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + market_reg_corn + region, data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn) + market_reg_corn + year + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + market_reg_corn + year +  region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + market_reg_corn + year + region, data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + year + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + year +  region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean - sbsd_corn)  + year + region, data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
table(regdat$sbsd_corn)
cut(regdat$sbsd_corn, c(0, 100, 200))
cut(regdat$sbsd_corn, c(-1,0, 100, 200))
cut(regdat$sbsd_corn, c(0,0, 100, 200))
cut(regdat$sbsd_corn, c(-1,0, 100, 200))
cut(regdat$sbsd_rice, c(-1,0, 100, 200))
cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300))
regdat$sbsd_corn_scale <- cut(regdat$sbsd_corn, c(-1,0, 100, 200))
regdat$sbsd_rice_scale <- cut(regdat$sbsd_rice, c(-1,0, 100, 200))
regdat$sbsd_soybean_scale  <- cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300))
as.numeric(cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300)))
cut(regdat$sbsd_corn, c(-1,0, 100, 200))
as.numeric(cut(regdat$sbsd_corn, c(-1,0, 100, 200)))
cut(regdat$sbsd_rice, c(-1,0, 100, 200))
regdat$sbsd_rice_scale <- as.numeric(cut(regdat$sbsd_rice, c(-1,0, 100, 200)))
as.numeric(cut(regdat$sbsd_rice, c(-1,0, 100, 200)))
cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300))
regdat$sbsd_soybean_scale  <- cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300,400))
cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300,400))
as.numeric(cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300,400)))-1
regdat$sbsd_corn_scale <- as.numeric(cut(regdat$sbsd_corn, c(-1,0, 100, 200)))-1
regdat$sbsd_rice_scale <- as.numeric(cut(regdat$sbsd_rice, c(-1,0, 100, 200)))-1
regdat$sbsd_soybean_scale  <- as.numeric(cut(regdat$sbsd_soybean, c(-1,0, 100, 200,300,400)))-1
regdat_V2 <- regdat %>% filter(!region %in% c("Shandong", "Hebei"))
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean_scale - sbsd_corn_scale)  + year + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean_scale - sbsd_corn_scale)  + year +  region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + I(sbsd_soybean_scale - sbsd_corn_scale)  + year + region, data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_soybean_scale + sbsd_corn_scale  + year + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_soybean_scale + sbsd_corn_scale  + year +  region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_soybean_scale + sbsd_corn_scale  + year + region, data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_corn + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean)  sbsd_rice + region,
lm_corn_pf <- lm(y2 ~ I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_corn + region,
data = regdat_V2 %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_rice + region,
data = regdat_V2 %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~  I(pfex_corn-subsidy_corn) + I(pfex_rice-subsidy_rice) + I(pfex_soy-subsidy_soybean) + sbsd_soybean + region ,
data = regdat_V2 %>% filter(crop == "soybean"))
#summary(lm_corn_pf)
#summary(lm_rice_pf)
#summary(lm_soy_pf)
stargazer(lm_corn_pf, lm_rice_pf, lm_soy_pf, title = "Model 1 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
?stargazer
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost)
names(rawcost) <- c("index", "region", "crop", "year", "value")
table(rawcost$region)
View(rawcost)
rawcost$region <- factor(rawcost$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shanxi", "Heilongjiang"))
table(rawcost$index)
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
library(tidyverse)
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
costdat$index <- factor(costdat$index, labels = c("yield", "price", "cost"))
table(costdat$crop)
table(costdat$region, costdat$crop)
costdat$crop <- factor(costdat$crop, labels = c("rice", "soybean", "wheat", "rice", "rice", "corn", "rice"))
table(costdat)
table(costdat$crop)
# now we want to use 18 different provinces
library(tidyverse)
### Data 1: Cost Data  (including yield, sale price, cost) ####
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost) <- c("index", "region", "crop", "year", "value")
rawcost$region <- factor(rawcost$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shanxi", "Heilongjiang"))
# (Note: have not sorted by year yet ! )
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
costdat$index <- factor(costdat$index, labels = c("yield", "price", "cost"))
table(costdat$index)
table(costdat$crop)
### Data 1: Acreage Information ####
rawacre <- readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/acre0821.xls")
names(rawacre)
colnames(rawacre) <- c("index", "region", "year", "value")
table(rawacre$index)
table(costdat$crop)
costdat$crop <- factor(costdat$crop, labels = c("rice", "soybean", "wheat", "rice", "rice", "corn", "rice"))
gg <- costdat %>% group_by(region, index, crop, year) %>% summarise(avg = mean(value))
warnings()
colSums(is.na(costdat))
costdat %>% filter(is.na(value)) %>% View()
gg <- costdat %>% group_by(region, index, crop, year) %>% summarise(avg = mean(value, na.rm = T))
View(gg)
head(costdat)
for(i in 1:nrow(costdat))
{
if(is.na(costdat$value[i]))
{
if(costdat$crop[i] %in% c("soybean", "wheat", "corn"))
{
costdat$value[i] <- 0
}
}
}
colSums(is.na(costdat))
costdat %>% filter(crop == "rice") %>% group_by(index, region, year) %>% summarise(total = n(), missing = sum(is.na(value))) %>% View()
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost) <- c("index", "region", "crop", "year", "value")
rawcost$region <- factor(rawcost$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shanxi", "Heilongjiang"))
# (Note: have not sorted by year yet ! )
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
costdat$index <- factor(costdat$index, labels = c("yield", "price", "cost"))
ricecateg <- c("中籼稻", "早籼稻", "晚籼稻", "粳稻")
table(rawcost$index, is.na(rawcost$value))
table(costdat$index, is.na(costdat$value))
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost) <- c("index", "region", "crop", "year", "value")
rawcost$region <- factor(rawcost$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shanxi", "Heilongjiang"))
# (Note: have not sorted by year yet ! )
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
costdat$index <- factor(costdat$index, labels = c("yield", "price", "cost"))
ricecateg <- c("中籼稻", "早籼稻", "晚籼稻", "粳稻")
costdat$crop <- factor(costdat$crop, labels = c("rice", "soybean", "wheat", "rice", "rice", "corn", "rice"))
# check which year only one rice and have missing value
tmp <- costdat %>% filter(crop == "rice") %>% group_by(index, region, year) %>%
summarise(total = n(), missing = sum(is.na(value)))
gg <- costdat %>% group_by(region, index, crop, year) %>% summarise(avg = sum(value, na.rm = T)/sum(!is.na(value)))
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value))))
costdat %>% filter(region == "Yunnan", index == "yield", crop == "rice", year == 2001)
tt <- costdat %>% filter(region == "Yunnan", index == "yield", crop == "rice", year == 2001)
tt %>% summarise(nrow())
tt %>% summarise(a = nrow())
tt %>% summarise(a = n())
tt %>% summarise(a = ifelse(n() == 1, 1, 4))
tt %>% summarise(a = sum(value, na.rm = T), b = sum(!is.na(value)))
tt %>% summarise(a = sum(value, na.rm = T))
head(costdat)
costdat$value <- as.numeric(costdat$value)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value))))
View(gg)
table(gg$crop, gg$year)
table(gg$crop, gg$year)/3
table(gg$crop, gg$region)
table(costdat$region)
table(rawcost$region)
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost) <- c("index", "region", "crop", "year", "value")
table(rawcost$region)
table(rawcost$region) %>% length()
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost) <- c("index", "region", "crop", "year", "value")
rawcost$region <- factor(rawcost$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
costdat$index <- factor(costdat$index, labels = c("yield", "price", "cost"))
ricecateg <- c("中籼稻", "早籼稻", "晚籼稻", "粳稻")
costdat$crop <- factor(costdat$crop, labels = c("rice", "soybean", "wheat", "rice", "rice", "corn", "rice"))
costdat$value <- as.numeric(costdat$value)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value))))
table(gg$crop, gg$region)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value)))) %>%
arrange(region, index, crop, year)
View(gg)
table(gg$year)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop, each = 21)), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
names(newcostdat)
head(gg)
gg$year <- is.numeric(gg$year)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop, each = 21)), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
View(newcostdat)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value)))) %>%
arrange(region, index, crop, year)
gg$year <- is.numeric(gg$year)
View(gg)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop, each = 21)), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
head(newcostdat)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop), each = 21), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
head(newcostdat)
head(gg)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value)))) %>%
arrange(region, index, crop, year) %>% ungroup()
gg$year <- is.numeric(gg$year)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop), each = 21), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
head(gg)
head(newcostdat)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value)))) %>%
arrange(region, index, crop, year) %>% ungroup()
gg$year <- as.numeric(gg$year)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop), each = 21), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
head(newcostdat)
View(newcostdat)
costdat <- newcostdat %>% spread(key = index, value = value)
costdat <- newcostdat %>% spread(key = index, value = avg)
View(costdat)
colSums(is.na(costdat))
table(is.na(costdat$cost), costdat$year)
head(costdat)
table(is.na(costdat$yield), costdat$year)
table(is.na(costdat$cost), costdat$year)
table(is.na(costdat$cost), costdat$year, costdat$crop)
library(tidyverse)
### Data 1: Cost Data  (including yield, sale price, cost) ####
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost) <- c("index", "region", "crop", "year", "value")
rawcost$region <- factor(rawcost$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
# (Note: have not sorted by year yet ! )
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
costdat$index <- factor(costdat$index, labels = c("yield", "price", "cost"))
ricecateg <- c("中籼稻", "早籼稻", "晚籼稻", "粳稻")
costdat$crop <- factor(costdat$crop, labels = c("rice", "soybean", "wheat", "rice", "rice", "corn", "rice"))
costdat$value <- as.numeric(costdat$value)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value)))) %>%
arrange(region, index, crop, year) %>% ungroup()
gg$year <- as.numeric(gg$year)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop), each = 21), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
costdat <- newcostdat %>% spread(key = index, value = avg)
avgcost <- readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/costavg0821.xls")
head(avgcost)
names(avgcost) <- c("index", "region", "crop", "year", "value")
table(avgcost$index)
avgcost <- avgcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
table(avgcost$index)
avgcost$index <- factor(avgcost$index, labels = c("yield", "price", "cost"))
table(avgcost$value)
table(avgcost$crop
)
avgcost$crop <- factor(avgcost$crop, labels = c("soybean", "wheat", "corn", "rice"))
avgcost$value <- as.numeric(avgcost$value)
head(avgcost)
names(avgcost) <- c("index", "region", "crop", "year", "avgvalue")
costdat %>% left_join(., avgcost %>% select(-region)) %>% head()
avgcost$year <- as.numeric(avgcost$year)
costdat %>% left_join(., avgcost %>% select(-region)) %>% head()
newcostdat %>% left_join(., avgcost %>% select(-region)) %>% head()
# combine data
newcostdat <- newcostdat %>% left_join(., avgcost %>% select(-region)) %>% head()
colSums(is.na(newcostdat))
library(tidyverse)
### Data 1: Cost Data  (including yield, sale price, cost) ####
rawcost <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
names(rawcost) <- c("index", "region", "crop", "year", "value")
rawcost$region <- factor(rawcost$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
# (Note: have not sorted by year yet ! )
costdat <- rawcost %>% filter(index %in% c("主产品产量（千克）", "平均出售价格（元）", "总成本（元）"))
costdat$index <- factor(costdat$index, labels = c("yield", "price", "cost"))
ricecateg <- c("中籼稻", "早籼稻", "晚籼稻", "粳稻")
costdat$crop <- factor(costdat$crop, labels = c("rice", "soybean", "wheat", "rice", "rice", "corn", "rice"))
costdat$value <- as.numeric(costdat$value)
gg <- costdat %>% group_by(region, index, crop, year) %>%
summarise(avg = ifelse(n() == 1, value, sum(value, na.rm = T)/sum(!is.na(value)))) %>%
arrange(region, index, crop, year) %>% ungroup()
gg$year <- as.numeric(gg$year)
# 18 provinces, 3 indexes, 4 crops, 21 years
newcostdat <- data.frame(region = rep(unique(gg$region), each = 3 * 4 * 21),
index = rep(rep(unique(gg$index), each = 4 * 21), 18),
crop = rep(rep(unique(gg$crop), each = 21), 18 * 3),
year = rep(2001:2021, 18 * 3 * 4))
newcostdat <- left_join(newcostdat, gg)
colSums(is.na(newcostdat))
dim(newcostdat)
# combine data
newcostdat <- newcostdat %>% left_join(., avgcost %>% select(-region))
colSums(is.na(newcostdat))
for(i in 1:nrow(newcostdat))
{
if(is.na(newcostdat$avg[i]))
{
newcostdat$avg[i] <- newcostdat$avgvalue[i]
}
}
costdat <- newcostdat %>% select(-avgvalue) %>% spread(key = index, value = avg)
colSums(is.na(costdat))
### Data 2: Acreage Information ####
rawacre <- readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/acre0821.xls")
colnames(rawacre) <- c("index", "region", "year", "value")
head(rawca)
head(rawacre)
View(rawacre)
table(rawacre$region)
rawacre$region <- factor(rawacre$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
table(rawacre)
table(rawacre$index)
rawacre$index <- factor(rawacre$index,
labels = c("total", "statefarm", "soybean",
"wheat", "corn", "rice", "allfarm"))
table(rawacre$index, rawacre$region)
head(rawacre)
bead(rawacre)
View(rawacre)
impute_values <- function(df) {
closest_year_with_value <- min(df$year[!is.na(df$value)])
for (i in 1:nrow(df)) {
if (is.na(df$value[i])) {
if (df$year[i] < closest_year_with_value) {
df$value[i] <- df$value[df$year == closest_year_with_value]
} else {
df$value[i] <- df$value[i - 1]
}
}
}
return(df)
}
# Applying the function to each combination of index and region
imputed_data <- rawacre %>%
group_by(index, region) %>%
nest() %>%
mutate(data = lapply(data, impute_values)) %>%
unnest(data)
View(imputed_data)
imputed_data <- imputed_data %>% spread(key = index, value = value)
head(imputed_data)
# Applying the function to each combination of index and region
imputed_data <- rawacre %>%
group_by(index, region) %>%
nest() %>%
mutate(data = lapply(data, impute_values)) %>%
unnest(data)
imputed_data <- imputed_data %>% spread(key = index, value = value) %<%
mutate_at(vars(total, statefarm, soybean, wheat, corn, rice, allfarm), as.numeric)
# Applying the function to each combination of index and region
imputed_data <- rawacre %>%
group_by(index, region) %>%
nest() %>%
mutate(data = lapply(data, impute_values)) %>%
unnest(data)
imputed_data <- imputed_data %>% spread(key = index, value = value) %>%
mutate_at(vars(total, statefarm, soybean, wheat, corn, rice, allfarm), as.numeric)
head(imputed_data)
imputed_data <- imputed_data %>% spread(key = index, value = value) %>%
mutate_at(vars(year, total, statefarm, soybean, wheat, corn, rice, allfarm), as.numeric)
# Applying the function to each combination of index and region
imputed_data <- rawacre %>%
group_by(index, region) %>%
nest() %>%
mutate(data = lapply(data, impute_values)) %>%
unnest(data)
imputed_data <- imputed_data %>% spread(key = index, value = value) %>%
mutate_at(vars(year, total, statefarm, soybean, wheat, corn, rice, allfarm), as.numeric)
head(imputed_data)
# we do not need 2000 data right now
acredat <- imputed_data %>% filter(year != 2000)
head(acredat)
# compute share
acredat <- acredat %>% mutate(soybean_share = round(100 * soybean/total, 2),
wheat_share = round(100 * wheat/total, 2),
corn_share = round(100 * corn/total, 2),
rice_share = round(100 * rice/total, 2),
stateprop = round(100 * statefarm/allfarm, 2)) %>%
mutate(other = 100 - soybean_share - wheat_share - corn_share - rice_share)
View(acredat)
acredat %>% group_by(region) %>% summarise(meanprop = mean(stateprop))
# we do not need 2000 data right now
acredat <- imputed_data %>% filter(year != 2000)
# compute share
acredat <- acredat %>% mutate(soybean_share = round(100 * soybean/total, 2),
wheat_share = round(100 * wheat/total, 2),
corn_share = round(100 * corn/total, 2),
rice_share = round(100 * rice/total, 2),
stateprop = round(100 * statefarm/allfarm/10, 2)) %>%
mutate(other = 100 - soybean_share - wheat_share - corn_share - rice_share)
acredat %>% group_by(region) %>% summarise(meanprop = mean(stateprop))
# we do not need 2000 data right now
acredat <- imputed_data %>% filter(year != 2000)
# compute share
acredat <- acredat %>% mutate(soybean_share = round(100 * soybean/total, 2),
wheat_share = round(100 * wheat/total, 2),
corn_share = round(100 * corn/total, 2),
rice_share = round(100 * rice/total, 2),
stateprop = round(100 * statefarm/total, 2)) %>%   # allfarm/10
mutate(other = 100 - soybean_share - wheat_share - corn_share - rice_share)
acredat %>% group_by(region) %>% summarise(meanprop = mean(stateprop))
