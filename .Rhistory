<<<<<<< HEAD
ggsave("Figure/fig_expprofit_nov.png",width = 6, height = 4)
ggsave("Figure/fig_expprofit_nov.png",width = 8, height = 4)
ggsave("Figure/fig_expprofit_sep.png",width = 8, height = 4)
fig_expprofit_sep <- ggplot(data = dta_plot, aes(y = (price_sep-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2004,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_sep.png",width = 8, height = 4)
#expected profit #November
fig_expprofit_nov <- ggplot(data = dta_plot, aes(y = (price_nov-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2004,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_nov.png",width = 8, height = 4)
fig_expprofit_sep <- ggplot(data = dta_plot, aes(y = (price_sep-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_sep.png",width = 8, height = 4)
#expected profit #November
fig_expprofit_nov <- ggplot(data = dta_plot, aes(y = (price_nov-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_nov.png",width = 8, height = 4)
fig_expprofit_sep <- ggplot(data = dta_plot, aes(y = (price_sep-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "Mature in September", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_sep.png",width = 8, height = 4)
#expected profit #November
fig_expprofit_nov <- ggplot(data = dta_plot, aes(y = (price_nov-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "Mature in November", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_nov.png",width = 8, height = 4)
#expected profit #November
fig_expprofit_nov <- ggplot(data = dta_plot, aes(y = (price_nov-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_nov.png",width = 8, height = 4)
fig_expprofit_sep <- ggplot(data = dta_plot, aes(y = (price_sep-cost)/7*`yield/mu`*6.07028433 , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_sep.png",width = 8, height = 4)
#actual profit
ggplot(data = dta_plot, aes(y = (price-cost)/7*`yield/mu`*6.07028433  , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
#actual profit
actual_profit <- ggplot(data = dta_plot, aes(y = (price-cost)/7*`yield/mu`*6.07028433  , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/actual_profit.png",width = 8, height = 4)
###price trend: corn, rice, soybean, and wheat
ptdata <- read_excel("AgData/raw data/1.profit.xls")
ptdata$year <- as.numeric(ptdata$year)
ptdata$value <- as.numeric(ptdata$value)
ptonly <- ptdata %>% filter(indicator == "price") %>% as.data.frame()
net_pf <- ptdata %>% filter(indicator == "netprofit") %>% as.data.frame()
head(net_pf)
new_pf %>% view()
view(net_pf)
view(mycost)
mycost$`profit/50kg`==mycost$`price/50kg`-mycost$`cost/mu`
mycost$`profit/50kg`-(mycost$`price/50kg`-mycost$`cost/mu`)
mycost$`profit/50kg`==mycost$`price/50kg`-mycost$`cost/50kg`
mycost$`profit/50kg`-(mycost$`price/50kg`-mycost$`cost/50kg`)
mycost <- mycost %>% mutate(`cost_actual/50kg` = "price/50kg"-"profit/50kg")
view(mycost)
mycost <- mycost %>% mutate(`cost_actual/50kg` = `price/50kg`-`profit/50kg`)
view(mycost)
mycost$`cost/50kg`-mycost$`cost_actual/50kg`
cb_kg <- mycost %>% select(-`cost/mu`,-`profit/mu`) %>% #original is per 50kg
mutate(price = `price/50kg`/50, #per kg
cost = `cost/50kg`/50,
profit = `profit/50kg`/50) %>%
select(-`price/50kg`,-`cost/50kg`,-`profit/50kg`) %>%
mutate(yield_acre = `yield/mu`*6.07028433)
#actual profit
actual_profit <- ggplot(data = dta_plot, aes(y = (price-cost)/7*`yield/acre`  , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
actual_profit
#actual profit
actual_profit <- ggplot(data = dta_plot, aes(y = (price-cost)/7*`yield_acre`  , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
actual_profit
#actual profit
actual_profit <- ggplot(data = dta_plot, aes(y = (price-cost)/7  , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
actual_profit
#actual profit
actual_profit <- ggplot(data = dta_plot, aes(y = (price-cost)/7*`yield_acre`  , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
actual_profit
fig_expprofit_sep <- ggplot(data = dta_plot, aes(y = (price_sep-cost)/7*yield_acre , x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+
theme_bw() +
labs(group = "crop")+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2020,2))+
scale_y_continuous(breaks=seq(-300,400,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
ggsave("Figure/fig_expprofit_sep.png",width = 8, height = 4)
mean(dta_plot$price_sep-dta_plot$price_nov)
mean(dta_plot$price_sep-dta_plot$price_nov, na.rm = T)
table(dta_plot$type)
dta_plot$crop == "corn"
dta[dta_plot$crop == "corn",]
dta[dta_plot$crop == "corn"]
dta[dta_plot$crop == "corn",]
dta_plot[dta_plot$crop == "corn",]
mean(dta_plot[dta_plot$crop == "corn",]$price_sep-dta_plot[dta_plot$crop == "corn",]$price_nov,na.rm = T)
ggplot(data = d5, aes(x = `截止日期_EndDt`, y = `结算价(元/吨)_SetPr`/7, group = `品种代码()_OptCd`, color = `品种代码()_OptCd`))+
geom_line(size = 1.2)+
xlab("") + ylab("Future price ($/ton)") + ggtitle("Maturity September")+
scale_y_continuous(breaks=seq(100,1000,100))+
scale_x_date(breaks = seq(from = as.Date("2005-01-01"), to = as.Date("2022-12-31"), by = "year"),
labels = format(seq(from = as.Date("2005-04-01"), to = as.Date("2022-12-31"), by = "year"), "%m/%d/%Y"))+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="top") +
scale_color_manual(name = "", values = c("#56B4E9","#E69F00", "#009E73","purple"), labels = c("Rice","Corn","Soybean","Wheat"))
ggplot(data = d5, aes(x = `截止日期_EndDt`, y = `结算价(元/吨)_SetPr`/7, group = `品种代码()_OptCd`, color = `品种代码()_OptCd`))+
geom_line(size = 1.2)+
xlab("") + ylab("Future price ($/ton)") + ggtitle("Future Price for September Delivery")+
scale_y_continuous(breaks=seq(100,1000,100))+
scale_x_date(breaks = seq(from = as.Date("2005-01-01"), to = as.Date("2022-12-31"), by = "year"),
labels = format(seq(from = as.Date("2005-04-01"), to = as.Date("2022-12-31"), by = "year"), "%m/%d/%Y"))+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="top") +
scale_color_manual(name = "", values = c("#56B4E9","#E69F00", "#009E73","purple"), labels = c("Rice","Corn","Soybean","Wheat"))
ggsave(width = 8, height = 4)
fig_future_sep <- ggplot(data = d5, aes(x = `截止日期_EndDt`, y = `结算价(元/吨)_SetPr`/7, group = `品种代码()_OptCd`, color = `品种代码()_OptCd`))+
geom_line(size = 1.2)+
xlab("") + ylab("Future price ($/ton)") + ggtitle("Future Price for September Delivery")+
scale_y_continuous(breaks=seq(100,1000,100))+
scale_x_date(breaks = seq(from = as.Date("2005-01-01"), to = as.Date("2022-12-31"), by = "year"),
labels = format(seq(from = as.Date("2005-04-01"), to = as.Date("2022-12-31"), by = "year"), "%m/%d/%Y"))+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="top") +
scale_color_manual(name = "", values = c("#56B4E9","#E69F00", "#009E73","purple"), labels = c("Rice","Corn","Soybean","Wheat"))
ggsave("fig_future_sep.png",width = 8, height = 6)
fig_future_sep
ggsave("fig_future_sep.png",width = 8, height = 6)
ggsave("Figure/fig_future_sep.png",width = 8, height = 6)
ggplot(data = d7, aes(x = `截止日期_EndDt`, y = `结算价(元/吨)_SetPr`/7, group = `品种代码()_OptCd`, color = `品种代码()_OptCd`))+
geom_line(size = 1.2)+
xlab("") + ylab("Future price ($/ton)") + ggtitle("Maturity November")+
scale_y_continuous(breaks=seq(100,1000,100))+
scale_x_date(breaks = seq(from = as.Date("2005-01-01"), to = as.Date("2022-12-31"), by = "year"),
labels = format(seq(from = as.Date("2005-04-01"), to = as.Date("2022-12-31"), by = "year"), "%m/%d/%Y"))+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="top") +
scale_color_manual(name = "", values = c("#56B4E9","#E69F00", "#009E73","purple"), labels = c("Rice","Corn","Soybean","Wheat"))
fig_future_nov <- ggplot(data = d7, aes(x = `截止日期_EndDt`, y = `结算价(元/吨)_SetPr`/7, group = `品种代码()_OptCd`, color = `品种代码()_OptCd`))+
geom_line(size = 1.2)+
xlab("") + ylab("Future price ($/ton)") + ggtitle("Maturity November")+
scale_y_continuous(breaks=seq(100,1000,100))+
scale_x_date(breaks = seq(from = as.Date("2005-01-01"), to = as.Date("2022-12-31"), by = "year"),
labels = format(seq(from = as.Date("2005-04-01"), to = as.Date("2022-12-31"), by = "year"), "%m/%d/%Y"))+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="top") +
scale_color_manual(name = "", values = c("#56B4E9","#E69F00", "#009E73","purple"), labels = c("Rice","Corn","Soybean","Wheat"))
ggsave("Figure/fig_future_nov.png",width = 8, height = 6)
fig_future_nov <- ggplot(data = d7, aes(x = `截止日期_EndDt`, y = `结算价(元/吨)_SetPr`/7, group = `品种代码()_OptCd`, color = `品种代码()_OptCd`))+
geom_line(size = 1.2)+
xlab("") + ylab("Future price ($/ton)") + ggtitle("Future Price for November Delivery")+
scale_y_continuous(breaks=seq(100,1000,100))+
scale_x_date(breaks = seq(from = as.Date("2005-01-01"), to = as.Date("2022-12-31"), by = "year"),
labels = format(seq(from = as.Date("2005-04-01"), to = as.Date("2022-12-31"), by = "year"), "%m/%d/%Y"))+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="top") +
scale_color_manual(name = "", values = c("#56B4E9","#E69F00", "#009E73","purple"), labels = c("Rice","Corn","Soybean","Wheat"))
ggsave("Figure/fig_future_nov.png",width = 8, height = 6)
gross_pay = 92149.26
federal_withhold = 12833.93
IA_withhold = 728.69
NJ_withhold = 3777.31
security_tax = 5291.78
medicare_tax = 1237.59
sui_sdi_tax = 169.16
#gross excluding 401k
gross_pay-k401
gross_pay = 92149.26
federal_withhold = 12833.93
IA_withhold = 728.69
NJ_withhold = 3777.31
security_tax = 5291.78
medicare_tax = 1237.59
sui_sdi_tax = 169.16
#pre_tax_benefit
insurance = 42.5 + 87.92+867.5
k401 = 4523.12
hsa = 2278.57+3521.43
income_federal_taxable = 80828.28
#gross excluding 401k
gross_pay-k401
income_federal_taxable = 80828.28
income_NJ_taxble = 87976.14
income_IA_taxble = 80828.22
gross_pay-k401
#wage and relocation
wage_total = 140000/12*7
relo_total = 4,222.46 + 7500
relo_total = 4222.46 + 7500
wage_total + relo_total
wage_total
#wage and relocation
wage_total = 140000/12*7
relo_total = 4222.46 + 7500
wage_total + relo_total
hsa = 2278.57+3521.43
gross_pay-k401-hsa
hsa_w2 = $6,150.00
hsa_w2 = 6150.00
gross_pay-k401-hsa_w2
81476.14-80828.28
gross_pay-k401-hsa_w2
wage_total + relo_total
gross_pay-k401-security_tax-medicare_tax-sui_sdi_tax
gross_pay-k401-security_tax-medicare_tax-sui_sdi_tax-129.5
80828+5291
k401+income_IA_taxble
87976.1-k401
gross_pay-k401
80828+5291
gross_pay-k401
80828+5291
80828+5291
k401+income_IA_taxble
gross_pay-k401-security_tax-medicare_tax-sui_sdi_tax
gross_pay-k401-security_tax-medicare_tax-sui_sdi_tax-famleave_tax
famleave_tax = 129.5
gross_pay-k401-security_tax-medicare_tax-sui_sdi_tax-famleave_tax
gross_pay-security_tax-medicare_tax-sui_sdi_tax-famleave_tax-k401
gross_pay-k401
wage_total + relo_total
wage_total + relo_total-401k
wage_total + relo_total
wage_total + relo_total-k401
###Heilongjiang,Jilin,Liaonign
dt_acre_Hei<- read_excel("AgData/raw data/4.ne.xls")
### Acreage share for corn, rice, and soybean -- Northeastern area
dta <- read_excel("~/Desktop/2021 Fall/Project/2.Agricultural Product/Data/acre_Jan17.xls", sheet = 3)
library(tidyverse)
library(readxl)
###Heilongjiang,Jilin,Liaonign
dt_acre_Hei<- read_excel("AgData/raw data/4.ne.xls")
dt_acre_Hei$value <- as.numeric(dt_acre_Hei$value)
dt_acre_Hei$year <-as.numeric(dt_acre_Hei$year)
mid1 <- dt_acre_Hei[dt_acre_Hei$type=="grain",]
mid2 <- dt_acre_Hei[dt_acre_Hei$type!="grain",]
mid3 <- cbind(mid2,mid1)
mid4 <- mid3[,c(1,2,3,4,8)]
names(mid4) <- c("type","region","year","value","grain")
head(mid4)
view(mid4)
###Heilongjiang Acreage
mid4 %>% filter(region == "Heilongjiang")
###Heilongjiang Acreage
acre_hei <- mid4 %>% filter(region == "Heilongjiang")
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_line()
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_line(group = 1)
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_line()
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
geom_line()
ggplot(data = acre_hei, aes(x = year, y = value,  color = value))+
geom_point()+
geom_line()
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
geom_line()
table(acre_hei$type)
acre_hei$type <- factor(acre_hei$type, levels = c("wheat","soybean","rice","corn"))
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
geom_line()+
scale_fill_manual(values = c("purple","#009E73","#56B4E9",  "#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
#geom_line()+
scale_fill_manual(values = c("purple","#009E73","#56B4E9",  "#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
scale_fill_manual(values = c("purple","#009E73","#56B4E9",  "#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
scale_color_manual(values = c("purple","#009E73","#56B4E9",  "#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
scale_color_discrete(values = c("purple","#009E73","#56B4E9",  "#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = value, color = value))+
geom_point()+
geom_line()+
scale_color_manual(values = c("purple","#009E73","#56B4E9",  "#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = value))+
geom_point()
ggplot(data = acre_hei, aes(x = year, y = value, group = value))+
geom_point()+
geom_smooth()
ggplot(data = acre_hei, aes(x = year, y = value, group = value))+
geom_point()+
geom_line()
ggplot(data = acre_hei, aes(x = year, y = value, group = type))+
geom_point()+
geom_line()
scale_color_manual(values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = type, color = type))+
geom_point()+
geom_line()+
scale_color_manual(values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
scale_color_manual(values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
scale_color_manual(values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
labs(y = "Thousand hectare")
ggplot(data = acre_hei, aes(x = year, y = value, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
labs(x = "Year", y = "Thousand hectare")+
scale_color_manual(values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
labs(x = "Year", y = "Thousand hectare")+
scale_color_manual(title = "", values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
labs(x = "Year", y = "Thousand hectare")+
scale_color_manual(name = "", values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value*0.001, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
labs(x = "Year", y = "Million hectare")+
scale_color_manual(name = "", values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value*0.001, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
labs(x = "Year", y = "Million hectare", title = "Planted Acreage in Heilongjiang")+
scale_color_manual(name = "", values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
ggplot(data = acre_hei, aes(x = year, y = value*0.001, group = type, color = type))+
geom_point()+
geom_line(size = 1.2)+
scale_x_continuous(breaks=seq(2000,2020,2))+
labs(x = "Year", y = "Million hectare", title = "Planted Acreage in Heilongjiang")+
scale_color_manual(name = "", values = c("purple","#009E73","#56B4E9","#E69F00"),labels = c("Wheat","Soybean","Corn","Rice"))
=======
library(sf)
library(tidyverse)
library(ggspatial)
chn_lv1 <- read_sf("MapData/gadm41_CHN_1.shp")
library(ggspatial)
chn_lv1 <- read_sf("MapData/gadm41_CHN_1.shp")
st_drivers()
chn_lv1 <- read_sf("MapData/gadm36_CHN_1.shp")
getwd()
chn_lv1 <- read_sf("MapData/gadm41_CHN_1.shp")
chn_st <- maptools::thinnedSpatialPoly(
as(chn_lv1, "Spatial"),tolerance = 0.1, minarea = 0.001,
topologyPreserve = TRUE)
chn <- st_as_sf(chn_st)
chn %>% transmute(ID = GID_1, points = geometry, name = NAME_1) %>%
split(.$ID) %>% purrr::map(function(x) get_df(x)) %>%
do.call(rbind, .) %>%
ggplot(aes(x = long, y = lat, group = group, fill = district)) + geom_polygon() +
scale_y_continuous(n.breaks = 5)  + theme_bw() + theme(legend.position = "none")
get_df <- function(geodf)
{
pointdf <- data.frame()
for(i in 1:nrow(geodf))
{
tmp <- geodf[i,]$geometry[[1]]
pointdf <-
rbind(pointdf,
lapply(1:length(tmp), FUN = function(x) data.frame(tmp[[x]][[1]], 1:nrow(tmp[[x]][[1]]),
paste0(geodf$ID[i], x), geodf$name[i])) %>%
do.call(rbind,.) %>% "names<-"(c("long", "lat","order", "group", "district")))  %>% return()
}
# return(pointdf)
}
chn %>% transmute(ID = GID_1, points = geometry, name = NAME_1) %>%
split(.$ID) %>% purrr::map(function(x) get_df(x)) %>%
do.call(rbind, .) %>%
ggplot(aes(x = long, y = lat, group = group, fill = district)) + geom_polygon() +
scale_y_continuous(n.breaks = 5)  + theme_bw() + theme(legend.position = "none")
chn %>% transmute(ID = GID_1, points = geometry, name = NAME_1) %>%
split(.$ID) %>% purrr::map(function(x) get_df(x)) %>%
do.call(rbind, .) %>%
ggplot(aes(x = long, y = lat, group = group, fill = district)) + geom_polygon() +
scale_y_continuous(n.breaks = 5)  + theme_bw() + theme(legend.position = "none")
get_df <- function(geodf)
{
pointdf <- data.frame()
for(i in 1:nrow(geodf))
{
tmp <- geodf[i,]$geometry[[1]]
pointdf <-
rbind(pointdf,
lapply(1:length(tmp), FUN = function(x) data.frame(tmp[[x]][[1]], 1:nrow(tmp[[x]][[1]]),
paste0(geodf$ID[i], x), geodf$name[i])) %>%
do.call(rbind,.) %>% "colnames<-"(c("long", "lat","order", "group", "district")))  %>% return()
}
# return(pointdf)
}
chn %>% transmute(ID = GID_1, points = geometry, name = NAME_1) %>%
split(.$ID) %>% purrr::map(function(x) get_df(x)) %>%
do.call(rbind, .) %>%
ggplot(aes(x = long, y = lat, group = group, fill = district)) + geom_polygon() +
scale_y_continuous(n.breaks = 5)  + theme_bw() + theme(legend.position = "none")
gg <- chn %>% transmute(ID = GID_1, points = geometry, name = NAME_1) %>%
split(.$ID)
gg[[1]]
get_df(gg[[1]])
gg
length(gg)
gg$CHN.1_1
get_df(gg$CHN.1_1)
geodf = gg$CHN.1_1
nrow(geodf)
pointdf <- data.frame()
tmp <- geodf[i,]$geometry[[1]]
pointdf <-
rbind(pointdf,
lapply(1:length(tmp), FUN = function(x) data.frame(tmp[[x]][[1]], 1:nrow(tmp[[x]][[1]]),
paste0(geodf$ID[i], x), geodf$name[i])) %>%
do.call(rbind,.) %>% "colnames<-"(c("long", "lat","order", "group", "district")))
i = 1
tmp <- geodf[i,]$geometry[[1]]
pointdf <-
rbind(pointdf,
lapply(1:length(tmp), FUN = function(x) data.frame(tmp[[x]][[1]], 1:nrow(tmp[[x]][[1]]),
paste0(geodf$ID[i], x), geodf$name[i])) %>%
do.call(rbind,.) %>% "colnames<-"(c("long", "lat","order", "group", "district")))
pointdf
tmp <- geodf$geometry[[1]]
length(tmp)
tmp
get_df <- function(geodf)
{
pointdf <- data.frame()
tmp <- geodf$geometry[[1]]
pointdf <-lapply(1:length(tmp), FUN = function(x) data.frame(tmp[[x]][[1]], 1:nrow(tmp[[x]][[1]]),
paste0(geodf$ID[i], x), geodf$name[i])) %>%
do.call(rbind,.) %>% "colnames<-"(c("long", "lat","order", "group", "district"))
return(pointdf)
}
chn %>% transmute(ID = GID_1, points = geometry, name = NAME_1) %>%
split(.$ID) %>% purrr::map(function(x) get_df(x)) %>%
do.call(rbind, .) %>%
ggplot(aes(x = long, y = lat, group = group, fill = district)) + geom_polygon() +
scale_y_continuous(n.breaks = 5)  + theme_bw() + theme(legend.position = "none")
>>>>>>> 4e9fa9a6774e361980583c2f93561f001f338efd
