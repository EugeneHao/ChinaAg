cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
###expected profits，Future price, lagged cost and yield, current subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre2, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
raw_hei <- raw_hei %>%
mutate(price = price_50kg/50,
cost = cost_50kg/50,
subsidy = `subsidy/mu`/yield_mu,
price_lag1 = lag(price, 1),
cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
subsidy_mu_lag1 = lag(`subsidy/mu`,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+subsidy_mu_lag1,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
raw_hei <- read_excel("AgData/raw data/price_cost_hei.xls")
raw_hei$数值 <- as.numeric(raw_hei$数值)
raw_hei$时间 <- as.numeric(raw_hei$时间)
raw_hei <- raw_hei %>%
pivot_wider(names_from = `指标`, values_from = `数值`)
names(raw_hei) <- c("region", "type","year","yield_mu","price_50kg","cost_50kg") #rename raw data
df <- data.frame(type = c("大豆","小麦","玉米","粳稻"),
crop = c("soybean","wheat", "corn","rice"),
code = c("335","365","330","328"))
raw_hei <- raw_hei %>% left_join(df, key = "type") %>%  #match cost data with future code
left_join(subsidy, key = c("crop","year")) #match subsidy data
raw_hei <- raw_hei %>%
mutate(price = price_50kg/50,
cost = cost_50kg/50,
subsidy = `subsidy/mu`/yield_mu,
price_lag1 = lag(price, 1),
cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
subsidy_mu_lag1 = lag(`subsidy/mu`,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+subsidy_mu_lag1,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ex_pro_acre3 = ex_pro_lag3 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
###expected profits，Future price, lagged cost and yield, current subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
###Future price, lag subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre3, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
raw_dat %>% select(c("ex_price","price","cost",`subsidy/mu`,"yield_mu"))
raw_dat %>% select(c("ex_price"/7,"price"/7,"cost"/7,`subsidy/mu`/7*acre,"yield_mu"*acre))
dta_pre<- raw_dat %>% select(c("ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>% #$dollar per acre
mutate(`future($/kg) ` = ex_price/7,
`price($/kg)` = price/7,
`cost($/kg)` = cost/7,
`subsidy($/acre)` = `subsidy/mu`*acre/7,
`yield (kg/acre)` = yield_mu*acre)
dta_pre <- raw_dat %>% select(c("ex_price","price","cost",`subsidy/mu`,"yield_mu","ex_pro_acre","ps_pro_acre","ex_pro_acre3"))
library(writexl)
install.packages("writexl")
library(writexl)
write_xlsx(dta_pre, "mypredata.xlsx")
head(raw_dat)
#save the data
dta_pre <- raw_dat %>% select(c("crop","year","ex_price","price","cost",`subsidy/mu`,"yield_mu","ex_pro_acre","ps_pro_acre","ex_pro_acre3"))
write_xlsx(dta_pre, "mypredata.xlsx")
###Future price, lag subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre3, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits, Last-year Subsidy")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
raw_dat$share
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
round(digits = 2)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu"))
lm(share ~ crop + ex_pro_acre)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu"))
lm(data = dta_pre,share ~ crop + ex_pro_acre)
lm(data = dta_pre,share ~  ex_pro_acre)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
lm(data = dta_pre,share ~  ex_pro_acre)
lm(data = dta_pre,share ~  ex_pro_acre) %>% summary()
lm(data = dta_pre,share ~  ex_pro_acre + crop) %>% summary()
lm(data = dta_pre,share ~  ex_price +cost+ crop+`subsidy/mu`) %>% summary()
lm(data = dta_pre,share ~  ex_price +cost+ `subsidy/mu`) %>% summary()
write_xlsx(dta_pre, "mypredata.xlsx")
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
write_xlsx(dta_pre, "mypredata.xlsx")
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,#lag2 yield
ex_pro_acre3 = ex_pro_lag3 * acre/7,#lag subsidy
ex_pro_acre4 = (ex_price- cost_lag1)*yield_mu+`subsidy/mu`
ps_pro_acre = pro_actual_lag1 * acre/7)
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,#lag2 yield
ex_pro_acre3 = ex_pro_lag3 * acre/7,#lag subsidy
ex_pro_acre4 = ((ex_price- cost_lag1)*yield_mu+`subsidy/mu`)* acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
write_xlsx(dta_pre, "mypredata.xlsx")
###Future price, lag subsidy, current yield
ggplot(data = raw_dat, aes(y = ex_pro_acre4, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits, Last-year Subsidy")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
###Future price, lag subsidy, current yield
ggplot(data = raw_dat, aes(y = ex_pro_acre4, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits, current yield, lagged subsidy")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
lm(data = dta_pre,share ~ ex_pro_acre ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre +crop ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3 +crop ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3  ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3 + crop ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3  ) %>% summary()
lm(data = dta_pre,share ~ ex_price + cost + `subsidy/mu` + yield_mu  ) %>% summary()
lm(data = dta_pre,share ~ ex_price + cost + `subsidy/mu` + yield_mu + crop ) %>% summary()
month_avg
write_xlsx(dta_pre, "month_avg.xlsx")
head(month_avg)
write_xlsx(month_avg, "month_avg.xlsx")
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
##hei
raw_hei <- read_excel("AgData/raw data/price_cost_hei.xls")
raw_hei$数值 <- as.numeric(raw_hei$数值)
raw_hei$时间 <- as.numeric(raw_hei$时间)
raw_hei <- raw_hei %>%
pivot_wider(names_from = `指标`, values_from = `数值`)
names(raw_hei) <- c("region", "type","year","yield_mu","price_50kg","cost_50kg") #rename raw data
df <- data.frame(type = c("大豆","小麦","玉米","粳稻"),
crop = c("soybean","wheat", "corn","rice"),
code = c("335","365","330","328"))
raw_hei <- raw_hei %>% left_join(df, key = "type") %>%  #match cost data with future code
left_join(subsidy, key = c("crop","year")) #match subsidy data
raw_hei <- raw_hei %>%
mutate(price = price_50kg/50,
cost = cost_50kg/50,
subsidy = `subsidy/mu`/yield_mu,
price_lag1 = lag(price, 1),
cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
subsidy_mu_lag1 = lag(`subsidy/mu`,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,#lag2 yield
ex_pro_acre3 = ex_pro_lag3 * acre/7,#lag subsidy
ex_pro_acre4 = ((ex_price- cost_lag1)*yield_mu+`subsidy/mu`)* acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
month_avg
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
lm(data = mypredata, ex_price~price)
###### Plot expected_profit (use last year price), expected_profit (use expected price) and share for each crop
ggplot(data = raw_dat) +
# geom_point(aes(x = year, y = pro_actual_lag1), size = 0.5) +
geom_point(aes(x = year, y = ex_pro_lag1), size = 0.5) +
geom_point(aes(x = year, y = (share - 0.2) * 1000), size = 0.5) +
# geom_line(aes(x = year, y = pro_actual_lag1, color = "Profit Using Previous Price"), size = 1)+
geom_line(aes(x = year, y = (share - 0.2) * 1000, color = "Share (%)"), size = 1)+
geom_line(aes(x = year, y = ex_pro_lag1, color = "Profit Using Future Price"), size = 1)+
scale_y_continuous(
name = "Expected Profit",
sec.axis = sec_axis(~ . /10 + 20, name = "Acreage Share")) +
scale_x_continuous(breaks=seq(2001,2021,2))+
facet_wrap(.~crop, nrow = 2) +
theme(legend.position='bottom')
###expected profits，Future price, lagged cost and yield, current subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
readRDS(file = "multidat_nolag.rds")
multidat_nolag <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/multidat_nolag.rds")
northeast <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/multidat_nolag.rds")
head(northeast)
View(northeast)
View(northeast)
northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1)
)
library(tidyverse)
northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1)
)
lm(ac_price ~ ex_price)
northeast <- northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1)
)
lm(ac_price ~ ex_price)
lm(ac_price ~ ex_price, data = northeast)
lm(ac_price ~ ex_price + crop , data = northeast)
lm(ac_price ~ ex_price * crop , data = northeast)
m1 <- lm(ac_price ~ ex_price * crop , data = northeast)
predictions <- predict(m1)
predictions
northeast$ad_price <- predict(m1)
view(northeast)
summary(m1)
m_predit <- lm(ac_price ~ ex_price * crop , data = northeast)
northeast$ad_price <- predict(m_predit)
view(northeast)
m1 <- lm(share ~ share_lag + price_ex + crop)
m1 <- lm(share ~ share_lag + price_ex + crop, data = northeast)
m1 <- lm(share ~ share_lag + ex_price + crop, data = northeast)
summary(m1)
m1 <- lm(share ~ share_lag + ad_price + crop, data = northeast)
summary(m2)
m2 <- lm(share ~ share_lag + ad_price + crop, data = northeast)
summary(m2)
summary(m1)
summary(m2)
summary(m1)
m1 <- lm(share ~ share_lag + ex_price + crop, data = northeast)
summary(m1)
m2 <- lm(share ~ share_lag + ad_price + crop, data = northeast)
summary(m2)
m2 <- lm(share ~ share_lag + ad_price + crop + subsidy, data = northeast)
m3 <- lm(share ~ share_lag + ad_price + crop + subsidy, data = northeast)
summary(m3)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy + cost, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy, data = northeast)
summary(m4)
northeast <- northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1),
four = ifelse(region == "Neimenggu"|"Heilongjiang"|"Jilin"|"Liaoning",1,0)
)
northeast <- northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1),
four = ifelse(region == "Neimenggu"|region == "Heilongjiang"|region == "Jilin"|region == "Liaoning",1,0)
)
view(northeast)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy + four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy * four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy + four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price * crop + subsidy + four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price  + subsidy + four, data = northeast)
summary(m4)
head(northeast)
library(dplyr)
yield_data <- yield_data %>%
group_by(year) %>%
mutate(avg_yield_last_three_years = ifelse(year >= (max(year)-2), mean(yield), NA))
northeast %>% group_by(year) %>%
mutate(avg_yield = ifelse(year >= (max(year)-2), mean(yield), NA))
yield_dta <- northeast %>% group_by(year) %>%
mutate(avg_yield = ifelse(year >= (max(year)-2), mean(yield), NA))
yield_dta$avg_yield
tail(northeast)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(avg_yield_preceding_3_years = ifelse(row_number() <= 3, NA, mean(yield[which(year %in% c(year[1]:year[row_number()-1]))])))
yield_dta$avg_yield_preceding_3_years
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(moving_avg_yield_3_years = ifelse(row_number() <= 2, NA, mean(yield[which(year %in% c(year[row_number()-2]:year[row_number()-1]))])))
yield_dta$moving_avg_yield_3_years
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(x = yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(x = yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(northeast$yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3, fill = NA))
yield_dta$yield_avg
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3))
yield_dta$yield_avg
rollmean(northeast$yield)
zoo::rollmean(northeast$yield, k = 3)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3))
yield_dta <- northeast %>%
arrange(year) %>%
group_by(crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3, fill = NA))
yield_dta$yield_avg
view(yield_dta)
zoo::rollmean(northeast$yield, k = 3, fill = NA)
mtcars
rollmean(mtcars$mpg,2)
zoo::rollmean(mtcars$mpg,2)
zoo::rollmean(mtcars$mpg,-2)
head
head(northeast)
library(tidyverse)
northeast <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/multidat_nolag.rds")
view
view(northeast)
