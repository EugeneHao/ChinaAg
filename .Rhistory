<<<<<<< Updated upstream
<<<<<<< HEAD
<<<<<<< HEAD
cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
###expected profits，Future price, lagged cost and yield, current subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre2, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
raw_hei <- raw_hei %>%
mutate(price = price_50kg/50,
cost = cost_50kg/50,
subsidy = `subsidy/mu`/yield_mu,
price_lag1 = lag(price, 1),
cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
subsidy_mu_lag1 = lag(`subsidy/mu`,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+subsidy_mu_lag1,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
raw_hei <- read_excel("AgData/raw data/price_cost_hei.xls")
raw_hei$数值 <- as.numeric(raw_hei$数值)
raw_hei$时间 <- as.numeric(raw_hei$时间)
raw_hei <- raw_hei %>%
pivot_wider(names_from = `指标`, values_from = `数值`)
names(raw_hei) <- c("region", "type","year","yield_mu","price_50kg","cost_50kg") #rename raw data
df <- data.frame(type = c("大豆","小麦","玉米","粳稻"),
crop = c("soybean","wheat", "corn","rice"),
code = c("335","365","330","328"))
raw_hei <- raw_hei %>% left_join(df, key = "type") %>%  #match cost data with future code
left_join(subsidy, key = c("crop","year")) #match subsidy data
raw_hei <- raw_hei %>%
mutate(price = price_50kg/50,
cost = cost_50kg/50,
subsidy = `subsidy/mu`/yield_mu,
price_lag1 = lag(price, 1),
cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
subsidy_mu_lag1 = lag(`subsidy/mu`,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+subsidy_mu_lag1,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,
ex_pro_acre3 = ex_pro_lag3 * acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
###expected profits，Future price, lagged cost and yield, current subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
###Future price, lag subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre3, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
raw_dat %>% select(c("ex_price","price","cost",`subsidy/mu`,"yield_mu"))
raw_dat %>% select(c("ex_price"/7,"price"/7,"cost"/7,`subsidy/mu`/7*acre,"yield_mu"*acre))
dta_pre<- raw_dat %>% select(c("ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>% #$dollar per acre
mutate(`future($/kg) ` = ex_price/7,
`price($/kg)` = price/7,
`cost($/kg)` = cost/7,
`subsidy($/acre)` = `subsidy/mu`*acre/7,
`yield (kg/acre)` = yield_mu*acre)
dta_pre <- raw_dat %>% select(c("ex_price","price","cost",`subsidy/mu`,"yield_mu","ex_pro_acre","ps_pro_acre","ex_pro_acre3"))
library(writexl)
install.packages("writexl")
library(writexl)
write_xlsx(dta_pre, "mypredata.xlsx")
head(raw_dat)
#save the data
dta_pre <- raw_dat %>% select(c("crop","year","ex_price","price","cost",`subsidy/mu`,"yield_mu","ex_pro_acre","ps_pro_acre","ex_pro_acre3"))
write_xlsx(dta_pre, "mypredata.xlsx")
###Future price, lag subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre3, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits, Last-year Subsidy")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
raw_dat$share
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
round(digits = 2)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu"))
lm(share ~ crop + ex_pro_acre)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu"))
lm(data = dta_pre,share ~ crop + ex_pro_acre)
lm(data = dta_pre,share ~  ex_pro_acre)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
lm(data = dta_pre,share ~  ex_pro_acre)
lm(data = dta_pre,share ~  ex_pro_acre) %>% summary()
lm(data = dta_pre,share ~  ex_pro_acre + crop) %>% summary()
lm(data = dta_pre,share ~  ex_price +cost+ crop+`subsidy/mu`) %>% summary()
lm(data = dta_pre,share ~  ex_price +cost+ `subsidy/mu`) %>% summary()
write_xlsx(dta_pre, "mypredata.xlsx")
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
write_xlsx(dta_pre, "mypredata.xlsx")
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,#lag2 yield
ex_pro_acre3 = ex_pro_lag3 * acre/7,#lag subsidy
ex_pro_acre4 = (ex_price- cost_lag1)*yield_mu+`subsidy/mu`
ps_pro_acre = pro_actual_lag1 * acre/7)
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,#lag2 yield
ex_pro_acre3 = ex_pro_lag3 * acre/7,#lag subsidy
ex_pro_acre4 = ((ex_price- cost_lag1)*yield_mu+`subsidy/mu`)* acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
write_xlsx(dta_pre, "mypredata.xlsx")
###Future price, lag subsidy, current yield
ggplot(data = raw_dat, aes(y = ex_pro_acre4, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits, Last-year Subsidy")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
###Future price, lag subsidy, current yield
ggplot(data = raw_dat, aes(y = ex_pro_acre4, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits, current yield, lagged subsidy")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
lm(data = dta_pre,share ~ ex_pro_acre ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre +crop ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3 +crop ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3  ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3 + crop ) %>% summary()
lm(data = dta_pre,share ~ ex_pro_acre3  ) %>% summary()
lm(data = dta_pre,share ~ ex_price + cost + `subsidy/mu` + yield_mu  ) %>% summary()
lm(data = dta_pre,share ~ ex_price + cost + `subsidy/mu` + yield_mu + crop ) %>% summary()
month_avg
write_xlsx(dta_pre, "month_avg.xlsx")
head(month_avg)
write_xlsx(month_avg, "month_avg.xlsx")
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
##hei
raw_hei <- read_excel("AgData/raw data/price_cost_hei.xls")
raw_hei$数值 <- as.numeric(raw_hei$数值)
raw_hei$时间 <- as.numeric(raw_hei$时间)
raw_hei <- raw_hei %>%
pivot_wider(names_from = `指标`, values_from = `数值`)
names(raw_hei) <- c("region", "type","year","yield_mu","price_50kg","cost_50kg") #rename raw data
df <- data.frame(type = c("大豆","小麦","玉米","粳稻"),
crop = c("soybean","wheat", "corn","rice"),
code = c("335","365","330","328"))
raw_hei <- raw_hei %>% left_join(df, key = "type") %>%  #match cost data with future code
left_join(subsidy, key = c("crop","year")) #match subsidy data
raw_hei <- raw_hei %>%
mutate(price = price_50kg/50,
cost = cost_50kg/50,
subsidy = `subsidy/mu`/yield_mu,
price_lag1 = lag(price, 1),
cost_lag1 = lag(cost,1),
subsidy_lag1 = lag(subsidy,1),
subsidy_mu_lag1 = lag(`subsidy/mu`,1),
yield_mu_lag1 = lag(yield_mu,1),
yield_mu_lag2 = lag(yield_mu,2)) #per kg
raw_dat <- raw_hei %>%
left_join(march_avg_11, key = c("code","year")) %>% #match future price
mutate(ex_price = price_ton_nov/1000,
ex_pro_lag1 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_lag2 = (ex_price- cost_lag1)*yield_mu_lag2+`subsidy/mu`,
ex_pro_lag3 = (ex_price- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
pro_actual_lag1 = (price_lag1- cost_lag1)*yield_mu_lag1+`subsidy/mu`,
ex_pro_acre = ex_pro_lag1 * acre/7,
ex_pro_acre2 = ex_pro_lag2 * acre/7,#lag2 yield
ex_pro_acre3 = ex_pro_lag3 * acre/7,#lag subsidy
ex_pro_acre4 = ((ex_price- cost_lag1)*yield_mu+`subsidy/mu`)* acre/7,
ps_pro_acre = pro_actual_lag1 * acre/7)
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_pro_acre","ex_pro_acre3","ps_pro_acre","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
month_avg
names(hei_acre) <- c("crop", "region","year", "value","share","total_crop")
hei_acre$crop <- as.character(hei_acre$crop)
raw_dat<- raw_dat %>% left_join(hei_acre, by = c("crop","year"))
#save the data
dta_pre <- raw_dat %>%
select(c("crop","code","year","share","ex_price","price","cost",`subsidy/mu`,"yield_mu")) %>%
mutate_if(is.numeric, ~round(., 2))
lm(data = mypredata, ex_price~price)
###### Plot expected_profit (use last year price), expected_profit (use expected price) and share for each crop
ggplot(data = raw_dat) +
# geom_point(aes(x = year, y = pro_actual_lag1), size = 0.5) +
geom_point(aes(x = year, y = ex_pro_lag1), size = 0.5) +
geom_point(aes(x = year, y = (share - 0.2) * 1000), size = 0.5) +
# geom_line(aes(x = year, y = pro_actual_lag1, color = "Profit Using Previous Price"), size = 1)+
geom_line(aes(x = year, y = (share - 0.2) * 1000, color = "Share (%)"), size = 1)+
geom_line(aes(x = year, y = ex_pro_lag1, color = "Profit Using Future Price"), size = 1)+
scale_y_continuous(
name = "Expected Profit",
sec.axis = sec_axis(~ . /10 + 20, name = "Acreage Share")) +
scale_x_continuous(breaks=seq(2001,2021,2))+
facet_wrap(.~crop, nrow = 2) +
theme(legend.position='bottom')
###expected profits，Future price, lagged cost and yield, current subsidy
ggplot(data = raw_dat, aes(y = ex_pro_acre, x = year, group = crop, color = crop, linetype = crop,shape = crop)) +
geom_point(size = 2.5)+
geom_line(size = 1.2)+
xlab("Year") + ylab("Net Profit ($/acre)")+ggtitle("Expected Profits in March Using Future Prices")+
#theme_bw() +
labs(group = "crop")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))+
theme(legend.title=element_blank(),legend.position="right") +
scale_shape_discrete(name = "", labels = c("Corn","Rice","Soybean", "Wheat")) +
scale_linetype_discrete(name = "", labels = c("Corn","Rice", "Soybean","Wheat")) +
geom_vline(aes(xintercept = 2016), color = "red", linetype = "dashed")+
geom_hline(aes(yintercept = 0), color = "grey")+
scale_x_continuous(breaks=seq(2000,2022,1))+
scale_y_continuous(breaks=seq(-300,500,100))+
scale_color_manual(name = "", values = c("#E69F00","#56B4E9", "#009E73","purple"), labels = c("Corn","Rice","Soybean","Wheat"))
readRDS(file = "multidat_nolag.rds")
multidat_nolag <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/multidat_nolag.rds")
northeast <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/multidat_nolag.rds")
head(northeast)
View(northeast)
View(northeast)
northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1)
)
library(tidyverse)
northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1)
)
lm(ac_price ~ ex_price)
northeast <- northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1)
)
lm(ac_price ~ ex_price)
lm(ac_price ~ ex_price, data = northeast)
lm(ac_price ~ ex_price + crop , data = northeast)
lm(ac_price ~ ex_price * crop , data = northeast)
m1 <- lm(ac_price ~ ex_price * crop , data = northeast)
predictions <- predict(m1)
predictions
northeast$ad_price <- predict(m1)
view(northeast)
summary(m1)
m_predit <- lm(ac_price ~ ex_price * crop , data = northeast)
northeast$ad_price <- predict(m_predit)
view(northeast)
m1 <- lm(share ~ share_lag + price_ex + crop)
m1 <- lm(share ~ share_lag + price_ex + crop, data = northeast)
m1 <- lm(share ~ share_lag + ex_price + crop, data = northeast)
summary(m1)
m1 <- lm(share ~ share_lag + ad_price + crop, data = northeast)
summary(m2)
m2 <- lm(share ~ share_lag + ad_price + crop, data = northeast)
summary(m2)
summary(m1)
summary(m2)
summary(m1)
m1 <- lm(share ~ share_lag + ex_price + crop, data = northeast)
summary(m1)
m2 <- lm(share ~ share_lag + ad_price + crop, data = northeast)
summary(m2)
m2 <- lm(share ~ share_lag + ad_price + crop + subsidy, data = northeast)
m3 <- lm(share ~ share_lag + ad_price + crop + subsidy, data = northeast)
summary(m3)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy + cost, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy, data = northeast)
summary(m4)
northeast <- northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1),
four = ifelse(region == "Neimenggu"|"Heilongjiang"|"Jilin"|"Liaoning",1,0)
)
northeast <- northeast %>% mutate(
ac_price = price/yield,
share_lag = lag(share,1),
four = ifelse(region == "Neimenggu"|region == "Heilongjiang"|region == "Jilin"|region == "Liaoning",1,0)
)
view(northeast)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy + four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy * four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price + crop + subsidy + four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price * crop + subsidy + four, data = northeast)
summary(m4)
m4 <- lm(share ~ share_lag + ad_price  + subsidy + four, data = northeast)
summary(m4)
head(northeast)
library(dplyr)
yield_data <- yield_data %>%
group_by(year) %>%
mutate(avg_yield_last_three_years = ifelse(year >= (max(year)-2), mean(yield), NA))
northeast %>% group_by(year) %>%
mutate(avg_yield = ifelse(year >= (max(year)-2), mean(yield), NA))
yield_dta <- northeast %>% group_by(year) %>%
mutate(avg_yield = ifelse(year >= (max(year)-2), mean(yield), NA))
yield_dta$avg_yield
tail(northeast)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(avg_yield_preceding_3_years = ifelse(row_number() <= 3, NA, mean(yield[which(year %in% c(year[1]:year[row_number()-1]))])))
yield_dta$avg_yield_preceding_3_years
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(moving_avg_yield_3_years = ifelse(row_number() <= 2, NA, mean(yield[which(year %in% c(year[row_number()-2]:year[row_number()-1]))])))
yield_dta$moving_avg_yield_3_years
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(x = yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(x = yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
yield_avg = zoo::rollmean(northeast$yield, k = 3, fill = NA)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3, fill = NA))
yield_dta$yield_avg
yield_dta <- northeast %>%
arrange(year) %>%
group_by(year,crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3))
yield_dta$yield_avg
rollmean(northeast$yield)
zoo::rollmean(northeast$yield, k = 3)
yield_dta <- northeast %>%
arrange(year) %>%
group_by(crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3))
yield_dta <- northeast %>%
arrange(year) %>%
group_by(crop,region) %>%
mutate(yield_avg = zoo::rollmean(yield, k = 3, fill = NA))
yield_dta$yield_avg
view(yield_dta)
zoo::rollmean(northeast$yield, k = 3, fill = NA)
mtcars
rollmean(mtcars$mpg,2)
zoo::rollmean(mtcars$mpg,2)
zoo::rollmean(mtcars$mpg,-2)
head
head(northeast)
library(tidyverse)
northeast <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/multidat_nolag.rds")
view
view(northeast)
=======
fitols <- systemfit( system, data = Kmenta )
## all coefficients
coef( fitols )
coef( summary( fitols ) )
## coefficients of the first equation
coef( fitols$eq[[1]] )
coef( summary( fitols$eq[[1]] ) )
## coefficients of the second equation
coef( fitols$eq[[2]] )
coef( summary( fitols$eq[[2]] ) )
## estimation with restriction by modifying the regressor matrix
modReg <- matrix( 0, 7, 6 )
colnames( modReg ) <- c( "demIntercept", "demPrice", "demIncome",
"supIntercept", "supPrice2", "supTrend" )
modReg[ 1, "demIntercept" ] <- 1
modReg[ 2, "demPrice" ] <- 1
modReg[ 3, "demIncome" ] <- 1
modReg[ 4, "supIntercept" ] <- 1
modReg[ 5, "supPrice2" ] <- 1
modReg[ 6, "supPrice2" ] <- 1
modReg[ 7, "supTrend" ] <- 1
fitols3 <- systemfit( system, data = Kmenta, restrict.regMat = modReg )
fitols3$coefCov
fitols3$residCov
modReg
lm_corn <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "corn"))
lm_rice <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "rice"))
lm_soy <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "soybean"))
regdat <- readRDS("From Hao/data/dongbei/regdat.rds") %>%
filter(region %in% c("Jilin", "Liaoning", "Heilongjiang"))
preddat <- readRDS("From Hao/data/dongbei/preddat.rds") %>%
filter(region %in% c("Jilin", "Liaoning", "Heilongjiang"))
# true share:
preddat$share %>% matrix(., nrow = 4)
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
lm_corn <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "corn"))
lm_rice <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "rice"))
lm_soy <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "wheat"))
pd_corn <- predict(lm_corn, newdata = preddat %>% filter(crop == "corn"))
pd_rice <- predict(lm_rice, newdata = preddat %>% filter(crop == "rice"))
pd_soy <- predict(lm_soy, newdata = preddat %>% filter(crop == "soybean"))
pd_wheat <- predict(lm_wheat, newdata = preddat %>% filter(crop == "wheat"))
y_pred <- rbind(pd_corn, pd_rice, pd_soy, pd_wheat)
share_est <- round(sweep(exp(y_pred), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred)) + 1) * 100, 2)
share_est
cov(lm_corn$residuals, lm_rice$residuals, lm_soy$residuals, lm_wheat$residuals)
lm_corn$residuals
cov(cbind(lm_corn$residuals, lm_rice$residuals, lm_soy$residuals, lm_wheat$residuals))
corr(cbind(lm_corn$residuals, lm_rice$residuals, lm_soy$residuals, lm_wheat$residuals))
cor(cbind(lm_corn$residuals, lm_rice$residuals, lm_soy$residuals, lm_wheat$residuals))
regdat_final <- regdat <- regdat %>%
mutate(share_corn = regdat %>% filter(crop == "corn") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_rice = regdat %>% filter(crop == "rice") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_soy = regdat %>% filter(crop == "soybean") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_wheat = regdat %>% filter(crop == "wheat") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
filter(crop == "corn")
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 100, methodResidCov = "noDfCor")
eq_corn <- share_corn ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn + region  # + pftrue_corn
eq_rice <- share_rice ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice + region
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 100, methodResidCov = "noDfCor")
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 100)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
regdat <- readRDS("From Hao/data/dongbei/regdat.rds") %>%
filter(region %in% c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"))
preddat <- readRDS("From Hao/data/dongbei/preddat.rds") %>%
filter(region %in% c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"))
# true share:
preddat$share %>% matrix(., nrow = 4)
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
lm_corn <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "corn"))
lm_rice <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "rice"))
lm_soy <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "wheat"))
pd_corn <- predict(lm_corn, newdata = preddat %>% filter(crop == "corn"))
pd_rice <- predict(lm_rice, newdata = preddat %>% filter(crop == "rice"))
pd_soy <- predict(lm_soy, newdata = preddat %>% filter(crop == "soybean"))
pd_wheat <- predict(lm_wheat, newdata = preddat %>% filter(crop == "wheat"))
y_pred <- rbind(pd_corn, pd_rice, pd_soy, pd_wheat)
share_est <- round(sweep(exp(y_pred), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred)) + 1) * 100, 2)
share_est
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
share_true
cor(cbind(lm_corn$residuals, lm_rice$residuals, lm_soy$residuals, lm_wheat$residuals))
regdat_final <- regdat <- regdat %>%
mutate(share_corn = regdat %>% filter(crop == "corn") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_rice = regdat %>% filter(crop == "rice") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_soy = regdat %>% filter(crop == "soybean") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_wheat = regdat %>% filter(crop == "wheat") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
filter(crop == "corn")
eq_corn <- share_corn ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn + region  # + pftrue_corn
eq_rice <- share_rice ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice + region
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
regdat <- readRDS("From Hao/data/dongbei/regdat.rds") # %>% filter(region %in% c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"))
preddat <- readRDS("From Hao/data/dongbei/preddat.rds") # %>% filter(region %in% c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"))
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
lm_corn <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "corn"))
lm_rice <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "rice"))
lm_soy <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat <- lm(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "wheat"))
pd_corn <- predict(lm_corn, newdata = preddat %>% filter(crop == "corn"))
pd_rice <- predict(lm_rice, newdata = preddat %>% filter(crop == "rice"))
pd_soy <- predict(lm_soy, newdata = preddat %>% filter(crop == "soybean"))
pd_wheat <- predict(lm_wheat, newdata = preddat %>% filter(crop == "wheat"))
y_pred <- rbind(pd_corn, pd_rice, pd_soy, pd_wheat)
share_est <- round(sweep(exp(y_pred), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred)) + 1) * 100, 2)
share_est
share_true
regdat_final <- regdat <- regdat %>%
mutate(share_corn = regdat %>% filter(crop == "corn") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_rice = regdat %>% filter(crop == "rice") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_soy = regdat %>% filter(crop == "soybean") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
share_wheat = regdat %>% filter(crop == "wheat") %>% "$"(share) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
filter(crop == "corn")
eq_corn <- share_corn ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn + region  # + pftrue_corn
eq_rice <- share_rice ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice + region
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
dim(regdat_final)
eq_corn <- share_corn ~ 0 + pfex_corn + pfex_rice + pftrue_corn + region  # + pftrue_corn
eq_rice <- share_rice ~ 0 + pfex_corn + pfex_rice + pftrue_rice + region
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
eq_corn <- share_corn ~ 0 + pfex_corn + pfex_rice # + pfex_soy + pfex_wheat + pftrue_corn + region  # + pftrue_corn
eq_rice <- share_rice ~ 0 + pfex_corn + pfex_rice # + pfex_soy + pfex_wheat + pftrue_rice + region
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
fitsur$residCov
fitsur$coefficients
eq_corn <- share_corn ~ 0 + pfex_corn + pfex_rice + region # + pfex_soy + pfex_wheat + pftrue_corn + region  # + pftrue_corn
eq_rice <- share_rice ~ 0 + pfex_corn + pfex_rice + region # + pfex_soy + pfex_wheat + pftrue_rice + region
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
lm_corn$coefficients
lm_corn$coefficients[-(1:5)]
eq_corn <- share_corn ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn + region  # + pftrue_corn
eq_rice <- share_rice ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice + region
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)])
regdat <- readRDS("From Hao/data/dongbei/regdat.rds") # %>% filter(region %in% c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"))
preddat <- readRDS("From Hao/data/dongbei/preddat.rds") # %>% filter(region %in% c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"))
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>% matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector())
regdat_final <- regdat %>%
mutate(
regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
as.vector() %>% rep(., each = 20)
) %>%
mutate(y = y - regionest) %>%   # remove the region est
mutate(y_corn = regdat %>% filter(crop == "corn") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_rice = regdat %>% filter(crop == "rice") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_soy = regdat %>% filter(crop == "soybean") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_wheat = regdat %>% filter(crop == "wheat") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
filter(crop == "corn")
eq_corn <- y_corn ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn   # + pftrue_corn
eq_rice <- y_rice ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
fitsur$residCovEst
eq_corn <- y_corn ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn   # + pftrue_corn
eq_rice <- y_rice ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice
eq_soy <- y_soy ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pfture_soy
eq_wheat <- y_wheat ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_wheat
system <- list(corn = eq_corn, rice = eq_rice)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
preddat_final
preddat_final <- preddat %>%
mutate(
regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
as.vector()
)
preddat_final
itsur$coefficients
fitsur$coefficients
system <- list(corn = eq_corn, rice = eq_rice, soy = eq_soy, wheat = eq_wheat)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
eq_soy <- y_soy ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_soy
eq_wheat <- y_wheat ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_wheat
system <- list(corn = eq_corn, rice = eq_rice, soy = eq_soy, wheat = eq_wheat)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
preddat_final <- preddat %>%
mutate(
regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
as.vector()
)
fitsur$coefficients
fitsur$coefficients %>% matrix(., ncol = 4)
surcoef <- fitsur$coefficients %>% matrix(., ncol = 4)
preddat_final$regionest
i = 1
which(unique(preddat_final$crop) == preddat_final$crop[i] )
i = 2
which(unique(preddat_final$crop) == preddat_final$crop[i] )
i = 10
which(unique(preddat_final$crop) == preddat_final$crop[i] )
fitsur
preddat_final$y_est <- 0
for(i in 1:nrow(preddat_final))
{
id <- which(unique(preddat_final$crop) == preddat_final$crop[i])
preddat_final$y_est[i] <- preddat_final$pfex_corn[i] * surcoef[1, id] + preddat_final$pfex_rice[i] * surcoef[2, id] +
preddat_final$pfex_soy[i] * surcoef[3, id] + preddat_final$pfex_wheat[i] * surcoef[4, id] +
preddat_final$pftrue_corn[i] * surcoef[5, id] + preddat_final$regionest[i]
}
preddat_final$y_est <- 0
for(i in 1:nrow(preddat_final))
{
id <- which(unique(preddat_final$crop) == preddat_final$crop[i])
preddat_final$y_est[i] <- preddat_final$pfex_corn[i] * surcoef[1, id] + preddat_final$pfex_rice[i] * surcoef[2, id] +
preddat_final$pfex_soy[i] * surcoef[3, id] + preddat_final$pfex_wheat[i] * surcoef[4, id] +
preddat_final$profit_true_lag[i] * surcoef[5, id] + preddat_final$regionest[i]
}
preddat_final$y_est
head(preddat
)
y_pred_sur <- preddat_final$y_est %>% matrix(., nrow = 4)
y_pred_sur
share_est_sur <- round(sweep(exp(y_pred_sur), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_sur)) + 1) * 100, 2)
share_est_sur
share_true
share_est
eq_corn <- y_corn ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn   # + pftrue_corn
eq_rice <- y_rice ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice
eq_soy <- y_soy ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_soy
eq_wheat <- y_wheat ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_wheat
system <- list(corn = eq_corn, rice = eq_rice, soy = eq_soy, wheat = eq_wheat)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
preddat_final <- preddat %>%
mutate(
regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
as.vector()
)
surcoef <- fitsur$coefficients %>% matrix(., ncol = 4)  # col = crop
preddat_final$y_est <- 0
for(i in 1:nrow(preddat_final))
{
id <- which(unique(preddat_final$crop) == preddat_final$crop[i])
preddat_final$y_est[i] <- surcoef[1, id] + preddat_final$pfex_corn[i] * surcoef[2, id] + preddat_final$pfex_rice[i] * surcoef[3, id] +
preddat_final$pfex_soy[i] * surcoef[4, id] + preddat_final$pfex_wheat[i] * surcoef[5, id] +
preddat_final$profit_true_lag[i] * surcoef[6, id] + preddat_final$regionest[i]
}
y_pred_sur <- preddat_final$y_est %>% matrix(., nrow = 4)
share_est_sur <- round(sweep(exp(y_pred_sur), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_sur)) + 1) * 100, 2)
share_est_sur
eq_corn <- y_corn ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn   # + pftrue_corn
eq_rice <- y_rice ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice
eq_soy <- y_soy ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_soy
eq_wheat <- y_wheat ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_wheat
system <- list(corn = eq_corn, rice = eq_rice, soy = eq_soy, wheat = eq_wheat)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
preddat_final <- preddat %>%
mutate(
regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
as.vector()
)
surcoef <- fitsur$coefficients %>% matrix(., ncol = 4)  # col = crop
preddat_final$y_est <- 0
for(i in 1:nrow(preddat_final))
{
id <- which(unique(preddat_final$crop) == preddat_final$crop[i])
preddat_final$y_est[i] <- preddat_final$pfex_corn[i] * surcoef[1, id] + preddat_final$pfex_rice[i] * surcoef[2, id] +
preddat_final$pfex_soy[i] * surcoef[3, id] + preddat_final$pfex_wheat[i] * surcoef[4, id] +
preddat_final$profit_true_lag[i] * surcoef[5, id] + preddat_final$regionest[i]
}
y_pred_sur <- preddat_final$y_est %>% matrix(., nrow = 4)
share_est_sur <- round(sweep(exp(y_pred_sur), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_sur)) + 1) * 100, 2)
share_est_sur
# For region, use random effect
library(lm4)
# For region, use random effect
=======
>>>>>>> 66f111e346937b9d4de74e9726540eea8c521506
library(lme4)
lm_corn_rand <- lmer(y ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "corn"))
lm_rice_rand <- lmer(y ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "rice"))
lm_soy_rand <- lmer(y ~  pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rand <- lmer(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "wheat"))
pd_corn_rand <- predict(lm_corn_rand, newdata = preddat %>% filter(crop == "corn"))
pd_rice_rand <- predict(lm_rice_rand, newdata = preddat %>% filter(crop == "rice"))
pd_soy_rand <- predict(lm_soy_rand, newdata = preddat %>% filter(crop == "soybean"))
pd_wheat_rand <- predict(lm_wheat_rand, newdata = preddat %>% filter(crop == "wheat"))
y_pred_rand <- rbind(pd_corn_rand, pd_rice_rand, pd_soy_rand, pd_wheat_rand)
share_est_rand <- round(sweep(exp(y_pred_rand), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_rand)) + 1) * 100, 2)
share_est_rand
# Use SUR Regression
library(systemfit)
library(lme4)
cor(cbind(lm_corn$residuals, lm_rice$residuals, lm_soy$residuals, lm_wheat$residuals))
# seems that corn and rice should be together
regdat_final <- regdat %>%
mutate(
# regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
#                   lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
#   as.vector() %>% rep(., each = 20)
regionest = rbind(ranef(lm_corn_rand) %>% unlist(), ranef(lm_rice_rand) %>% unlist(),
ranef(lm_soy_rand) %>% unlist(), ranef(lm_wheat_rand) %>% unlist()) %>%
as.vector() %>% rep(., each = 20)
) %>%
mutate(y = y - regionest) %>%   # remove the region est
mutate(y_corn = regdat %>% filter(crop == "corn") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_rice = regdat %>% filter(crop == "rice") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_soy = regdat %>% filter(crop == "soybean") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_wheat = regdat %>% filter(crop == "wheat") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
filter(crop == "corn")
eq_corn <- y_corn ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn   # + pftrue_corn
eq_rice <- y_rice ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice
eq_soy <- y_soy ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_soy
eq_wheat <- y_wheat ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_wheat
system <- list(corn = eq_corn, rice = eq_rice, soy = eq_soy, wheat = eq_wheat)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
preddat_final <- preddat %>%
mutate(
# regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
#                   lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
#   as.vector()
regionest = rbind(ranef(lm_corn_rand) %>% unlist(), ranef(lm_rice_rand) %>% unlist(),
ranef(lm_soy_rand) %>% unlist(), ranef(lm_wheat_rand) %>% unlist()) %>%
as.vector()
)
surcoef <- fitsur$coefficients %>% matrix(., ncol = 4)  %>% "[" (c(2:6, 1), ) # col = crop
preddat_final$y_est <- 0
for(i in 1:nrow(preddat_final))
{
id <- which(unique(preddat_final$crop) == preddat_final$crop[i])
preddat_final$y_est[i] <- preddat_final$pfex_corn[i] * surcoef[1, id] + preddat_final$pfex_rice[i] * surcoef[2, id] +
preddat_final$pfex_soy[i] * surcoef[3, id] + preddat_final$pfex_wheat[i] * surcoef[4, id] +
preddat_final$profit_true_lag[i] * surcoef[5, id] + preddat_final$regionest[i] + surcoef[6, id]
}
y_pred_sur <- preddat_final$y_est %>% matrix(., nrow = 4)
share_est_sur <- round(sweep(exp(y_pred_sur), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_sur)) + 1) * 100, 2)
share_est_sur
<<<<<<< HEAD
share_true
share_est
share_est_rand
table(regdat$share == 0.1)
preddat$share
table(regdat$share < 0.1)
>>>>>>> a557fee815028891e394b9b1d976dc8dd66dc46c
=======
surcoef
fitsur
lm_corn <- lm(y ~ 0 # + yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
lm_corn <- lm(y ~ 0 + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + pfex_corn + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + pfex_corn, # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
# region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + profit_true_lag + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
names(region)
names(regdat)
lm_corn <- lm(y ~ 0 + profit_ex_lag + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
names(region)
names(regdat)
lm_corn <- lm(y ~ 0 + pftrlag_corn + pftrlag_rice + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
View(regdat)
ggplot(aes(x = pftrlag_corn, y = share), data = regdat) + geom_point()
ggplot(aes(x = pftrlag_corn, y = share), data = regdat) + geom_point() + facet_wrap(~region, nrow = 2)
483.4 * (0.9098 - 0.833889)
483.4 * (1.18157 - 0.833889)
ggplot(aes(x = pftrlag_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = yield_lag * ex_price + subsidy_lag, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
facet_wrap(~region, nrow = 2, scales = "free_y")
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector())
ggplot(aes(x = revex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
facet_wrap(~region, nrow = 2, scales = "free_y")
lm_corn <- lm(y ~ 0 + pftrlag_corn + pftrlag_rice + region,
data = regdat %>% filter(crop == "corn"))
lm_corn <- lm(y ~ 0 + pfex_corn + region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + revex_corn + region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
ggplot(aes(x = pftrlag_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth() +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = pfex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth() +
facet_wrap(~region, nrow = 2, scales = "free_y")
?geom_smooth
ggplot(aes(x = pfex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = pfex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = log(revex_corn), y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
names(regdat)
lm_corn_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
lm_corn_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
=======
>>>>>>> Stashed changes
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
lm(y ~ 0 +  revex_wheat + region,
data = regdat %>% filter(crop == "wheat")) %>% summary()
lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "wheat"))
lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "wheat")) %>% summary()
lm_corn_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())%>%
mutate(rr_corn = revex_corn/revex_wheat,
rr_rice = revex_rice/revex_wheat,
rr_soy = revex_soy/revex_wheat)
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(rr_corn = revex_corn/revex_wheat,
rr_rice = revex_rice/revex_wheat,
rr_soy = revex_soy/revex_wheat)
lm_corn_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rr)
summary(lm_rice_rr)
summary(lm_soy_rr)
summary(lm_wheat_rr)
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "rice")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_rice, y = log(share)), data = regdat %>% filter(crop == "rice")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
?facet_wrap
ggplot(aes(x = revex_rice, y = log(share)), data = regdat %>% filter(crop == "rice")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free")
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_soy, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_soy, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free")
ggplot(aes(x = revex_wheat, y = log(share)), data = regdat %>% filter(crop == "wheat")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free")
lm_corn_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat  + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat  + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat  + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
lm_corn_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rr)
summary(lm_rice_rr)
summary(lm_soy_rr)
summary(lm_wheat_rr)
<<<<<<< Updated upstream
>>>>>>> 66f111e346937b9d4de74e9726540eea8c521506
=======
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = regdat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = regdat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = regdat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = regdat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())%>%
mutate(rr_corn = revex_corn/revex_wheat,
rr_rice = revex_rice/revex_wheat,
rr_soy = revex_soy/revex_wheat,
rc_corn = tcost_corn/tcost_wheat,
rc_rice = tcost_rice/tcost_wheat,
rc_soy = tcost_soy/tcost_wheat)
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = preddat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = preddat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = preddat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = preddat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(rr_corn = revex_corn/revex_wheat,
rr_rice = revex_rice/revex_wheat,
rr_soy = revex_soy/revex_wheat,
rc_corn = tcost_corn/tcost_wheat,
rc_rice = tcost_rice/tcost_wheat,
rc_soy = tcost_soy/tcost_wheat)
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = regdat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = regdat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = regdat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = regdat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())%>%
mutate(rr_corn = revex_corn/revex_rice,
rr_soy = revex_soy/revex_rice,
rc_corn = tcost_corn/tcost_rice,
rc_soy = tcost_soy/tcost_rice)
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = preddat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = preddat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = preddat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = preddat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(rr_corn = revex_corn/revex_rice,
rr_soy = revex_soy/revex_rice,
rc_corn = tcost_corn/tcost_rice,
rc_soy = tcost_soy/tcost_rice)
names(regdat)
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost)) %>%
mutate(share_wheat = regdat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))   # get new y2 since now we combine other and wheat
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost)) %>%
mutate(share_wheat = regdat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost)) %>%
mutate(share_wheat = predat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
regdat <- regdat %>%
mutate(share_wheat = regdat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))   # get new y2 since now we combine other and wheat
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
preddat <- preddat %>%
mutate(share_wheat = preddat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4) %>% "["(-4,)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = regdat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = regdat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = regdat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = regdat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())%>%
mutate(rr_corn = revex_corn/revex_rice,
rr_soy = revex_soy/revex_rice,
rc_corn = tcost_corn/tcost_rice,
rc_soy = tcost_soy/tcost_rice)
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = preddat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = preddat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = preddat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = preddat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(rr_corn = revex_corn/revex_rice,
rr_soy = revex_soy/revex_rice,
rc_corn = tcost_corn/tcost_rice,
rc_soy = tcost_soy/tcost_rice)
head(regdat$y2)
head(regdat$y)
names(regdat)
>>>>>>> Stashed changes
