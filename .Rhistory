data = regdat %>% filter(crop == "soybean"))
stargazer(lm_corn_rr2, lm_rice_rr2, lm_soy_rr2, title = "Model 5 Results",column.labels = c("Corn", "Rice", "Soybean"), type = "text", digit = 3, dep.var.caption  = "")
pd_corn_pf <- predict(lm_corn_pf, newdata = preddat %>% filter(crop == "corn"))
pd_rice_pf <- predict(lm_rice_pf, newdata = preddat %>% filter(crop == "rice"))
pd_soy_pf <- predict(lm_soy_pf, newdata = preddat %>% filter(crop == "soybean"))
y_pred_pf <- rbind(pd_corn_pf, pd_rice_pf, pd_soy_pf)
share_est_pf <- round(sweep(exp(y_pred_pf), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_pf)) + 1) * 100, 2)
pd_corn_rev <- predict(lm_corn_rev, newdata = preddat %>% filter(crop == "corn"))
pd_rice_rev <- predict(lm_rice_rev, newdata = preddat %>% filter(crop == "rice"))
pd_soy_rev <- predict(lm_soy_rev, newdata = preddat %>% filter(crop == "soybean"))
y_pred_rev <- rbind(pd_corn_rev, pd_rice_rev, pd_soy_rev)
share_est_rev <- round(sweep(exp(y_pred_rev), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_rev)) + 1) * 100, 2)
pd_corn_rr<- predict(lm_corn_rr, newdata = preddat %>% filter(crop == "corn"))
pd_rice_rr <- predict(lm_rice_rr, newdata = preddat %>% filter(crop == "rice"))
pd_soy_rr <- predict(lm_soy_rr, newdata = preddat %>% filter(crop == "soybean"))
y_pred_rr <- rbind(pd_corn_rr, pd_rice_rr, pd_soy_rr)
share_est_rr <- round(sweep(exp(y_pred_rr), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_rr)) + 1) * 100, 2)
#model 5
pd_corn_rr2 <- predict(lm_corn_rr2, newdata = preddat %>% filter(crop == "corn"))
pd_rice_rr2 <- predict(lm_rice_rr2, newdata = preddat %>% filter(crop == "rice"))
pd_soy_rr2 <- predict(lm_soy_rr2, newdata = preddat %>% filter(crop == "soybean"))
y_pred_rr2 <- rbind(pd_corn_rr2, pd_rice_rr2, pd_soy_rr2)
share_est_rr2 <- round(sweep(exp(y_pred_rr2), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_rr2)) + 1) * 100, 2)
pd_corn_pftr <- predict(lm_corn_pftr, newdata = preddat %>% filter(crop == "corn"))
pd_rice_pftr <- predict(lm_rice_pftr, newdata = preddat %>% filter(crop == "rice"))
pd_soy_pftr <- predict(lm_soy_pftr, newdata = preddat %>% filter(crop == "soybean"))
y_pred_pftr <- rbind(pd_corn_pftr, pd_rice_pftr, pd_soy_pftr)
share_est_pftr <- round(sweep(exp(y_pred_pftr), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_pftr)) + 1) * 100, 2)
share_true %>% data.frame() %>% "colnames<-"(unique(regdat$region)) %>%
"rownames<-"(unique(regdat$crop)[-4]) %>% pander::pander()
predd
preddat
predict(lm_corn_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn") %>% View()
pd_corn_rev_all <- predict(lm_corn_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_rev_all <- predict(lm_rice_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_rev_all <- predict(lm_soy_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
head(regdat)
# model 1: predict y2 first
pd_corn_pf_all <- predict(lm_corn_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_pf_all <- predict(lm_rice_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_pf_all <- predict(lm_soy_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 1: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_pf <- 1/(exp(pd_corn_pf_all) + exp(pd_rice_pf_all) + exp(pd_soy_pf_all) + 1)
s_corn_pf <- s_other_pf * exp(pd_corn_pf_all)
s_rice_pf <- s_other_pf * exp(pd_rice_pf_all)
s_soy_pf <- s_other_pf * exp(pd_soy_pf_all)
s_other_pf
s_other_pf + s_corn_pf + s_rice_pf + s_soy_pf
table(regdat$region)
share_true %>% data.frame() %>% "colnames<-"(unique(regdat$region)) %>%
"rownames<-"(unique(regdat$crop)[-4]) %>% pander::pander()
alldat <- rbind(regdat, preddat) %>%
arrange(region, crop, year)
dim(alldat)
84 * 4
head(alldat)
View(alldat)
c((1:21), (1:21) + 84, (1:21) + 84 * 2)
share_ture = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4) %>%
"["(c((1:21), (1:21) + 84, (1:21) + 84 * 2, (1:21) + 84 * 3,
(22:42), (22:42) + 84, (22:42) + 84 * 2, (22:42) + 84 * 3,
(43:63), (43:63) + 84, (43:63) + 84 * 2, (43:63) + 84 * 3,
(64:84), (64:84) + 84, (64:84) + 84 * 2, (64:84) + 84 * 3), ) %>%
as.vector()
alldat <- rbind(regdat, preddat) %>%
arrange(region, crop, year)
share_ture = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4) %>%
)
share_ture = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
dim(share_true)
c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3])
c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
share_ture = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
share_true = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
dim(share_true)
c(share_true[1:21, ], share_true[22:42, ], share_true[43:63, ], share_true[64:84, ])
alldat <- rbind(regdat, preddat) %>%
arrange(region, crop, year)
share_true = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
# model 1: predict y2 first
pd_corn_pf_all <- predict(lm_corn_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_pf_all <- predict(lm_rice_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_pf_all <- predict(lm_soy_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 1: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_pf <- 1/(exp(pd_corn_pf_all) + exp(pd_rice_pf_all) + exp(pd_soy_pf_all) + 1)
s_corn_pf <- s_other_pf * exp(pd_corn_pf_all)
s_rice_pf <- s_other_pf * exp(pd_rice_pf_all)
s_soy_pf <- s_other_pf * exp(pd_soy_pf_all)
predshare <- data.frame(region = rep(rep(c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"), each = 21), 4),
crop = rep(c("corn", "rice", "soybean", "other"), each = 84),
share_true = c(share_true[1:21, ], share_true[22:42, ],
share_true[43:63, ], share_true[64:84, ]),
share_pf = c(s_corn_pf, s_rice_pf, s_soy_pf, s_other_pf))
View(predshare)
alldat <- rbind(regdat, preddat) %>%
arrange(region, crop, year)
share_true = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
# model 1: predict y2 first
pd_corn_pf_all <- predict(lm_corn_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_pf_all <- predict(lm_rice_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_pf_all <- predict(lm_soy_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 1: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_pf <- 1/(exp(pd_corn_pf_all) + exp(pd_rice_pf_all) + exp(pd_soy_pf_all) + 1)
s_corn_pf <- s_other_pf * exp(pd_corn_pf_all)
s_rice_pf <- s_other_pf * exp(pd_rice_pf_all)
s_soy_pf <- s_other_pf * exp(pd_soy_pf_all)
predshare <- data.frame(region = rep(rep(c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"), each = 21), 4),
crop = rep(c("corn", "rice", "soybean", "other"), each = 84),
share_true = c(share_true[1:21, ], share_true[22:42, ],
share_true[43:63, ], share_true[64:84, ]),
share_pf = round(100 * c(s_corn_pf, s_rice_pf, s_soy_pf, s_other_pf), 2))
alldat <- rbind(regdat, preddat) %>%
arrange(region, crop, year)
share_true = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
# model 1: predict y2 first
pd_corn_pf_all <- predict(lm_corn_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_pf_all <- predict(lm_rice_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_pf_all <- predict(lm_soy_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 1: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_pf <- 1/(exp(pd_corn_pf_all) + exp(pd_rice_pf_all) + exp(pd_soy_pf_all) + 1)
s_corn_pf <- s_other_pf * exp(pd_corn_pf_all)
s_rice_pf <- s_other_pf * exp(pd_rice_pf_all)
s_soy_pf <- s_other_pf * exp(pd_soy_pf_all)
# model 2: predict y2 first
pd_corn_rev_all <- predict(lm_corn_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_rev_all <- predict(lm_rice_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_rev_all <- predict(lm_soy_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 2: transform back to share
s_other_rev <- 1/(exp(pd_corn_rev_all) + exp(pd_rice_rev_all) + exp(pd_soy_rev_all) + 1)
s_corn_rev <- s_other_rev * exp(pd_corn_rev_all)
s_rice_rev <- s_other_rev * exp(pd_rice_rev_all)
s_soy_rev <- s_other_rev * exp(pd_soy_rev_all)
# combine the results
predshare <- data.frame(region = rep(rep(c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"), each = 21), 4),
crop = rep(c("corn", "rice", "soybean", "other"), each = 84),
share_true = c(share_true[1:21, ], share_true[22:42, ],
share_true[43:63, ], share_true[64:84, ]),
share_pf = round(100 * c(s_corn_pf, s_rice_pf, s_soy_pf, s_other_pf), 2),
share_rev = round(100 * c(s_corn_rev, s_rice_rev, s_soy_rev, s_other_rev), 2))
alldat <- rbind(regdat, preddat) %>%
arrange(region, crop, year)
share_true = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
# model 1: predict y2 first
pd_corn_pf_all <- predict(lm_corn_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_pf_all <- predict(lm_rice_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_pf_all <- predict(lm_soy_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 1: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_pf <- 1/(exp(pd_corn_pf_all) + exp(pd_rice_pf_all) + exp(pd_soy_pf_all) + 1)
s_corn_pf <- s_other_pf * exp(pd_corn_pf_all)
s_rice_pf <- s_other_pf * exp(pd_rice_pf_all)
s_soy_pf <- s_other_pf * exp(pd_soy_pf_all)
# model 2: predict y2 first
pd_corn_rev_all <- predict(lm_corn_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_rev_all <- predict(lm_rice_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_rev_all <- predict(lm_soy_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 2: transform back to share
s_other_rev <- 1/(exp(pd_corn_rev_all) + exp(pd_rice_rev_all) + exp(pd_soy_rev_all) + 1)
s_corn_rev <- s_other_rev * exp(pd_corn_rev_all)
s_rice_rev <- s_other_rev * exp(pd_rice_rev_all)
s_soy_rev <- s_other_rev * exp(pd_soy_rev_all)
# model 3: predict y2 first
pd_corn_rr_all <- predict(lm_corn_rr, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_rr_all <- predict(lm_rice_rr, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_rr_all <- predict(lm_soy_rr, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 3: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_rr <- 1/(exp(pd_corn_rr_all) + exp(pd_rice_rr_all) + exp(pd_soy_rr_all) + 1)
s_corn_rr <- s_other_rr * exp(pd_corn_rr_all)
s_rice_rr <- s_other_rr * exp(pd_rice_rr_all)
s_soy_rr <- s_other_rr * exp(pd_soy_rr_all)
# combine the results
predshare <- data.frame(region = rep(rep(c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"), each = 21), 4),
crop = rep(c("corn", "rice", "soybean", "other"), each = 84),
share_true = c(share_true[1:21, ], share_true[22:42, ],
share_true[43:63, ], share_true[64:84, ]),
share_pf = round(100 * c(s_corn_pf, s_rice_pf, s_soy_pf, s_other_pf), 2),
share_rev = round(100 * c(s_corn_rev, s_rice_rev, s_soy_rev, s_other_rev), 2),
share_rr = round(100 * c(s_corn_rr, s_rice_rr, s_soy_rr, s_other_rr), 2))
predshare
alldat <- rbind(regdat, preddat) %>%
arrange(region, crop, year)
share_true = c(alldat$share[1:63], alldat$other[64:84],
alldat$share[(1:63) + 84], alldat$other[(64:84) + 84],
alldat$share[(1:63) + 84 * 2], alldat$other[(64:84) + 84 * 2],
alldat$share[(1:63) + 84 * 3], alldat$other[(64:84) + 84 * 3]) %>%
matrix(., ncol = 4)
# model 1: predict y2 first
pd_corn_pf_all <- predict(lm_corn_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_pf_all <- predict(lm_rice_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_pf_all <- predict(lm_soy_pf, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 1: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_pf <- 1/(exp(pd_corn_pf_all) + exp(pd_rice_pf_all) + exp(pd_soy_pf_all) + 1)
s_corn_pf <- s_other_pf * exp(pd_corn_pf_all)
s_rice_pf <- s_other_pf * exp(pd_rice_pf_all)
s_soy_pf <- s_other_pf * exp(pd_soy_pf_all)
# model 2: predict y2 first
pd_corn_rev_all <- predict(lm_corn_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_rev_all <- predict(lm_rice_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_rev_all <- predict(lm_soy_rev, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 2: transform back to share
s_other_rev <- 1/(exp(pd_corn_rev_all) + exp(pd_rice_rev_all) + exp(pd_soy_rev_all) + 1)
s_corn_rev <- s_other_rev * exp(pd_corn_rev_all)
s_rice_rev <- s_other_rev * exp(pd_rice_rev_all)
s_soy_rev <- s_other_rev * exp(pd_soy_rev_all)
# model 3: predict y2 first
pd_corn_rr_all <- predict(lm_corn_rr, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "corn"))
pd_rice_rr_all <- predict(lm_rice_rr, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "rice"))
pd_soy_rr_all <- predict(lm_soy_rr, newdata = rbind(regdat, preddat) %>%
arrange(region, crop, year) %>% filter(crop == "soybean"))
# model 3: transform back to share
# Neimenggu 2001, Neimenggu 2002, ..., Neimenggu 2021,
s_other_rr <- 1/(exp(pd_corn_rr_all) + exp(pd_rice_rr_all) + exp(pd_soy_rr_all) + 1)
s_corn_rr <- s_other_rr * exp(pd_corn_rr_all)
s_rice_rr <- s_other_rr * exp(pd_rice_rr_all)
s_soy_rr <- s_other_rr * exp(pd_soy_rr_all)
# combine the results
predshare <- data.frame(region = rep(rep(c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"), each = 21), 4),
crop = rep(c("corn", "rice", "soybean", "other"), each = 84),
year = rep(2001:2021, 16),
share_true = c(share_true[1:21, ], share_true[22:42, ],
share_true[43:63, ], share_true[64:84, ]),
share_pf = round(100 * c(s_corn_pf, s_rice_pf, s_soy_pf, s_other_pf), 2),
share_rev = round(100 * c(s_corn_rev, s_rice_rev, s_soy_rev, s_other_rev), 2),
share_rr = round(100 * c(s_corn_rr, s_rice_rr, s_soy_rr, s_other_rr), 2))
# combine the results
predshare <- data.frame(region = rep(rep(c("Neimenggu", "Jilin", "Liaoning", "Heilongjiang"), each = 21), 4),
crop = rep(c("corn", "rice", "soybean", "other"), each = 84),
year = rep(2001:2021, 16),
share_true = c(share_true[1:21, ], share_true[22:42, ],
share_true[43:63, ], share_true[64:84, ]),
share_pf = round(100 * c(s_corn_pf, s_rice_pf, s_soy_pf, s_other_pf), 2),
share_rev = round(100 * c(s_corn_rev, s_rice_rev, s_soy_rev, s_other_rev), 2),
share_rr = round(100 * c(s_corn_rr, s_rice_rr, s_soy_rr, s_other_rr), 2))
predshare
view(predshare)
print(predshare)
head(regdat)
view(regdat)
view(preddat)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat_V2.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
regdat_V2 <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat_V2.rds")
regdat <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat_V2.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
regdat <- regdat %>%
mutate(share_wheat = regdat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))   # get new y2 since now we combine other and wheat
preddat <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat_V2.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
preddat <- preddat %>%
mutate(share_wheat = preddat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4) %>% "["(-4,)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = regdat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = regdat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = regdat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = regdat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())%>%
mutate(rr_corn = revex_corn/revex_soy,
rr_rice = revex_rice/revex_soy,
rc_corn = tcost_corn/tcost_soy,
rc_rice = tcost_rice/tcost_soy)
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftr_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_corn = preddat %>% filter(crop == "corn") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_rice = preddat %>% filter(crop == "rice") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_soy = preddat %>% filter(crop == "soybean") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
tcost_wheat = preddat %>% filter(crop == "wheat") %>% "$"(tcost) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(rr_corn = revex_corn/revex_soy,
rr_rice = revex_rice/revex_soy,
rc_corn = tcost_corn/tcost_soy,
rc_rice = tcost_rice/tcost_soy)
regdat <- regdat %>% filter(!region %in% c("Shandong", "Hebei"))
preddat <- preddat %>% filter(!region %in% c("Shandong", "Hebei"))
# model 1:
lm_corn_pf <- lm(y2 ~ pfex_corn + pfex_rice + pfex_soy + I(subsidy > 0) + # revex_corn +
region,
data = regdat %>% filter(crop == "corn"))
lm_rice_pf <- lm(y2 ~ pfex_corn + pfex_rice + pfex_soy + I(subsidy > 0) + # revex_rice +
region,
data = regdat %>% filter(crop == "rice"))
lm_soy_pf <- lm(y2 ~ pfex_corn + pfex_rice + pfex_soy + I(subsidy > 0) + # revex_soy +
region,
data = regdat %>% filter(crop == "soybean"))
summary(lm_corn_pf)
summary(lm_rice_pf)
summary(lm_soy_pf)
# model 2:
lm_corn_rev <- lm(y2 ~ revex_corn + revex_rice + revex_soy + I(subsidy > 0) +
region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y2 ~ revex_corn + revex_rice + revex_soy + I(subsidy > 0) +
region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y2 ~ revex_corn + revex_rice + revex_soy + I(subsidy > 0) +
region,
data = regdat %>% filter(crop == "soybean"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
# model 3:
lm_corn_rr <- lm(y2 ~ rr_corn + rr_rice + # revex_corn +
I(subsidy > 0) + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rr <- lm(y2 ~ rr_corn + rr_rice + # revex_rice +
I(subsidy > 0) + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rr <- lm(y2 ~  rr_corn + rr_rice + # revex_soy +
I(subsidy > 0) + region,
data = regdat %>% filter(crop == "soybean"))
summary(lm_corn_rr)
summary(lm_rice_rr)
regdat
view(regdat)
regdat <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat_V2.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
view(regdat )
regdat <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat_V2.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag,
tcost = yield_lag * cost,
rcratio = (yield_lag * ex_price + subsidy_lag)/(yield_lag * cost))
