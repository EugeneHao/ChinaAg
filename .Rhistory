<<<<<<< Updated upstream
geom_point(aes(x = factor(year), y = pct_corn)) +
facet_wrap(~region)+
theme_classic() +
xlab("Year")+
ylab("% Change in Corn Share Per Year")+
scale_fill_manual(
values = c("TRUE" = "green", "FALSE" = "red"),
labels = c("Negative", "Positive"),
name = NULL
=======
my_fuprice <- left_join(my_fuprice, price) %>% mutate(price = price/50)
# impute the missing future price
for(i in unique(my_fuprice$crop))
{
if(i == "rice")
{
price_diff <- (my_fuprice %>% filter(crop == i, !is.na(ex_price)) %>% "$"(ex_price) %>% mean()) -
(my_fuprice %>% filter(crop == i, !is.na(ex_price)) %>% "$"(price) %>% mean())
my_fuprice$ex_price[is.na(my_fuprice$ex_price) & (my_fuprice$crop == i)] <-
my_fuprice$price[is.na(my_fuprice$ex_price) & (my_fuprice$crop == i)] + price_diff
} else
{
lm_exprice <- lm(ex_price ~ price, dat = my_fuprice %>% filter(crop == i))
my_fuprice$ex_price[is.na(my_fuprice$ex_price) & (my_fuprice$crop == i)] <-
predict(lm_exprice, newdata = my_fuprice %>% filter(crop == i, is.na(ex_price)))
}
}
names(my_fuprice)[4] <- "national"
multidat <- multidat %>% left_join(., my_fuprice, by = c("crop", "year"))
head(costdat)
head(acredat)
# combine the two data sets
multidat <- left_join(costdat,
acredat %>% select(region, year, soybean_share, wheat_share,
corn_share, rice_share, stateprop, other) %>%
gather(key = crop, value = share, -region, -year, -other, -stateprop) %>%
mutate(crop = factor(crop, labels = c("corn", "rice", "soybean", "wheat"))))
head(multidat)
multidat %>% filter(crop == "rice") %>% group_by(region) %>% summarise(rice = mean(share))
multidat %>% filter(crop == "corn") %>% group_by(region) %>% summarise(corn = mean(share))
multidat %>% filter(crop == "soybean") %>% group_by(region) %>% summarise(soybean = mean(share))
multidat %>% filter(crop == "wheat") %>% group_by(region) %>% summarise(soybean = mean(wheat))
multidat %>% filter(crop == "wheat") %>% group_by(region) %>% summarise(wheat = mean(share))
multidat <- multidat %>% left_join(., my_fuprice, by = c("crop", "year"))
head(multidat)
subsidy <- readRDS("From Hao/data/heilongjiang/dat.rds") %>% select(crop, year, subsidy_mu) %>%
"colnames<-"(c("crop", "year", "subsidy"))
# add land fertility protection subsidies (for V2)
subsidy$subsidy[subsidy$year == 2015] <- subsidy$subsidy[subsidy$year == 2015] + 57.58
subsidy$subsidy[subsidy$year == 2016] <- subsidy$subsidy[subsidy$year == 2016] + 71.45
subsidy$subsidy[subsidy$year == 2017] <- subsidy$subsidy[subsidy$year == 2017] + 71.50
subsidy$subsidy[subsidy$year == 2018] <- subsidy$subsidy[subsidy$year == 2018] + 71.70
subsidy$subsidy[subsidy$year == 2019] <- subsidy$subsidy[subsidy$year == 2019] + 72.41
subsidy$subsidy[subsidy$year == 2020] <- subsidy$subsidy[subsidy$year == 2020] + 56.72
subsidy$subsidy[subsidy$year == 2021] <- subsidy$subsidy[subsidy$year == 2021] + 56.72
multidat <- multidat %>% left_join(., subsidy)
multidat$subsidy[is.na(multidat$subsidy)] <- 0
# change cost unit to yuan/kg
multidat$cost <- multidat$cost/multidat$yield
# important! arrange before we calculate lag
multidat <- multidat %>% arrange(region, crop)
# transform price to unit price
multidat <- multidat %>% mutate(price = price/yield)
multidat <- multidat %>%
mutate(profit_true = yield * (price - cost) + subsidy)
multidat$yield_lag <- get_lag(multidat, "yield", 3, weight = c(0.34, 0.33, 0.33))
get_lag <- function(data, oldname, lag, weight)
{
newvec <- NULL
index = which(names(data) == oldname)
for(i in unique(data$region))
{
for(j in unique(data$crop))
{
tmpdat <- data %>% filter(region == i, crop == j)
length <- nrow(tmpdat)
oldvec <- tmpdat[,index] %>% unlist()
tmpvec <- NULL
for(k in 1:lag)
{
tmpvec <- cbind(tmpvec, c(rep(oldvec[1], k), oldvec[-(length + 1 - (1:k))]))
}
newvec <- c(newvec, as.vector(tmpvec %*% weight))
}
}
return(newvec)
}
multidat$yield_lag <- get_lag(multidat, "yield", 3, weight = c(0.34, 0.33, 0.33))
multidat$subsidy_lag <- get_lag(multidat, "subsidy", 2, weight = c(0.67, 0.33))
multidat <- multidat %>% mutate(profit_ex = yield_lag * (ex_price - cost) + subsidy_lag)
multidat$profit_ex_lag <- get_lag(multidat, "profit_ex", 1, weight = 1)
multidat$profit_true_lag <- get_lag(multidat, "profit_true", 1, weight = 1)
multidat <- multidat %>% mutate(profit_ex = yield_lag * (ex_price - cost) )   # now not include subsidy ! # + subsidy_lag
multidat$profit_ex_lag <- get_lag(multidat, "profit_ex", 1, weight = 1)
multidat$profit_true_lag <- get_lag(multidat, "profit_true", 1, weight = 1)
# arrange the data set
multidat <- multidat %>% arrange(region, crop, year)
multidat <- multidat %>%
mutate(pfex_corn = multidat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 21) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = multidat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 21) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = multidat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 21) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = multidat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 21) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector()
>>>>>>> Stashed changes
)
#rice
ggplot(data = share_change) +
geom_line(aes(x = factor(year), y = pct_rice), color = "blue", group = 1) +
geom_col(aes(x = factor(year), y = pct_rice, fill = pct_rice > 0))+
geom_point(aes(x = factor(year), y = pct_rice)) +
facet_wrap(~region)+
theme_classic() +
xlab("Year")+
ylab("% Change in Rice Share Per Year")+
scale_fill_manual(
values = c("TRUE" = "green", "FALSE" = "red"),
labels = c("Negative", "Positive"),
name = NULL
)
#wheat
ggplot(data = share_change) +
geom_line(aes(x = factor(year), y = pct_wheat), color = "blue", group = 1) +
geom_col(aes(x = factor(year), y = pct_wheat, fill = pct_wheat > 0))+
geom_point(aes(x = factor(year), y = pct_wheat)) +
facet_wrap(~region)+
theme_classic() +
xlab("Year")+
ylab("% Change in Wheat Share Per Year")+
scale_fill_manual(
values = c("TRUE" = "green", "FALSE" = "red"),
labels = c("Negative", "Positive"),
name = NULL
)
#vege
ggplot(data = share_change) +
geom_line(aes(x = factor(year), y = pct_vege), color = "blue", group = 1) +
geom_col(aes(x = factor(year), y = pct_vege, fill = pct_vege > 0))+
geom_point(aes(x = factor(year), y = pct_vege)) +
facet_wrap(~region)+
theme_classic() +
xlab("Year")+
ylab("% Change in Vegetable Share Per Year")+
scale_fill_manual(
values = c("TRUE" = "green", "FALSE" = "red"),
labels = c("Negative", "Positive"),
name = NULL
)
#fruit
ggplot(data = share_change) +
geom_line(aes(x = factor(year), y = pct_fruit), color = "blue", group = 1) +
geom_col(aes(x = factor(year), y = pct_fruit, fill = pct_fruit > 0))+
geom_point(aes(x = factor(year), y = pct_fruit)) +
facet_wrap(~region)+
theme_classic() +
xlab("Year")+
ylab("% Change in Fruit Share Per Year")+
scale_fill_manual(
values = c("TRUE" = "green", "FALSE" = "red"),
labels = c("Negative", "Positive"),
name = NULL
)
#spatial effects
ggplot(data = acre, aes(x = year, y = share_soy,)) +
geom_point()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region == "Nation"), aes(x = factor(year))) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"), group = 1)+
geom_point(aes(y = share_corn))+
geom_point(aes(y = share_rice))+
geom_point(aes(y = share_wheat))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre %>% filter(region == "Nation"), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soy"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_point(aes(y = share_wheat, color = "wheat"))+
geom_point(aes(y = share_vege, color = "vege"))+
geom_point(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre %>% filter(region == "Nation"), aes(x = factor(year) )) +
geom_point(aes(y = share_corn, color = "corn"), group = 1)+
geom_point(aes(y = share_soy, color = "soy"), group = 1)+
geom_point(aes(y = share_rice, color = "rice"), group = 1)+
geom_point(aes(y = share_wheat, color = "wheat"))+
geom_point(aes(y = share_vege, color = "vege"))+
geom_point(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre , aes(x = factor(year) )) +
geom_point(aes(y = share_corn, color = "corn"), group = 1)+
geom_point(aes(y = share_soy, color = "soy"), group = 1)+
geom_point(aes(y = share_rice, color = "rice"), group = 1)+
geom_point(aes(y = share_wheat, color = "wheat"))+
geom_point(aes(y = share_vege, color = "vege"))+
geom_point(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre , aes(x = factor(year) )) +
geom_point(aes(y = share_corn, color = "corn"), group = 1)+
geom_point(aes(y = share_soy, color = "soy"), group = 1)+
geom_point(aes(y = share_rice, color = "rice"), group = 1)+
geom_point(aes(y = share_wheat, color = "wheat"))+
geom_point(aes(y = share_vege, color = "vege"))+
geom_point(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year) )) +
geom_point(aes(y = share_corn, color = "corn"), group = 1)+
geom_point(aes(y = share_soy, color = "soy"), group = 1)+
geom_point(aes(y = share_rice, color = "rice"), group = 1)+
geom_point(aes(y = share_wheat, color = "wheat"))+
geom_point(aes(y = share_vege, color = "vege"))+
geom_point(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soy"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"))+
geom_line(aes(y = share_vege, color = "vege"))+
geom_line(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soy"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"))+
geom_line(aes(y = share_vege, color = "vege"))+
geom_line(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soy"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"))+
geom_line(aes(y = share_vege, color = "vege"))+
geom_line(aes(y = share_fruit, color = "fruit"))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soy"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "yellow"), group = 1)+
geom_line(aes(y = share_soy, color = "soy"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soy"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
acre %>% filter(region == "Anhui")
acre %>% filter(region == "Anhui") %>% view()
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "sown acre in total"), group = 1) +
geom_line(aes(y = share_rice, color = "rice"), group = 1) +
xlab("Year")
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "sown acre in total"), group = 1) +
geom_line(aes(y = share_rice, color = "rice"), group = 1) +
xlab("Year")+
theme_bw()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "sown acre in total"), group = 1) +
geom_line(aes(y = share_rice, color = "rice"), group = 1) +
xlab("Year")+
theme_classic()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "sown acre in total"), group = 1)+
xlab("Year")+
theme_classic()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "sown acre in total"), group = 1)+
xlab("Year")+
ylab("sown acre in total")
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "sown acre in total"), group = 1)+
xlab("Year")+
ylab("sown acre in total")+
theme_classic()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "crop sown acre in total"), group = 1)+
xlab("Year")+
ylab("sown acre in total")+
theme_classic()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "blue"), group = 1)+
xlab("Year")+
ylab(" Crop sown acre in total")+
theme_classic()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total, color = "blue"), group = 1)+
xlab("Year")+
ylab(" Crop sown acre in total")+
theme_classic()
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total), group = 1)+
xlab("Year")+
ylab(" Crop sown acre in total")+
theme_classic()
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn", shape = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn", linetype = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn", linetype = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn", linetype = "solid"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn", linetype = "dashed"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)+
scale_color_manual(values = c("corn" = "red",
"soybean" = "blue",
"rice" = "green",
"wheat" = "purple",
"vege" = "orange",
"fruit" = "brown"))
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)+
scale_color_manual(values = c("corn" = "red",
"soybean" = "blue",
"rice" = "green",
"wheat" = "grey",
"vege" = "orange",
"fruit" = "yellow"))
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)+
scale_color_manual(values = c("corn" = "red",
"soybean" = "blue",
"rice" = "green",
"wheat" = "pink",
"vege" = "orange",
"fruit" = "black"))
ggplot(data = acre %>% filter(region %in% c("Anhui", "Liaoning") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)+
scale_color_manual(values = c("corn" = "red",
"soybean" = "blue",
"rice" = "green",
"wheat" = "purple",
"vege" = "orange",
"fruit" = "black"))
ggplot(data = acre %>% filter(region == "Anhui"), aes(x = factor(year)))+
geom_line(aes(y = acre_total), group = 1)+
xlab("Year")+
ylab(" Crop sown acre in Anhui")+
theme_classic()
ggplot(data = acre %>% filter(region == "Liaoning"), aes(x = factor(year)))+
geom_line(aes(y = acre_total), group = 1)+
xlab("Year")+
ylab(" Crop sown acre in Liaoning")+
theme_classic()
ggplot(data = acre %>% filter(region == "Liaoning"), aes(x = factor(year)))+
geom_line(aes(y = acre_total), group = 1)+
xlab("Year")+
ylab(" Crop sown acre in Liaoning")+
theme_classic()
ggplot(data = acre %>% filter(region == c("Liaoning", "Anhui")), aes(x = factor(year)))+
geom_line(aes(y = acre_total), group = 1)+
xlab("Year")+
ylab("Crop sown acre in total")+
theme_classic()+
facet_wrap(~"region")
ggplot(data = acre %>% filter(region == c("Liaoning", "Anhui")), aes(x = factor(year)))+
geom_line(aes(y = acre_total), group = 1)+
xlab("Year")+
ylab("Crop sown acre in total")+
theme_classic()+
facet_wrap(~region)
acre %>% filter(region == "Heilongjiang")
acre %>% filter(year %in% c(2017, 2018)) select(c(acre_corn,share_corn))
acre %>% filter(year %in% c(2017, 2018)) %>% select(c(acre_corn,share_corn))
acre %>% filter(year %in% c(2017, 2018)) %>% select(c(region,acre_corn,share_corn)) %>% view()
acre %>% filter(year %in% c(2017, 2018)) %>% select(c(region,year,acre_corn,share_corn)) %>% view()
acre %>% filter(year %in% c(2017, 2018)) %>% select(c(region,year,acre_corn,share_corn, crop_weight)) %>% view()
ggplot(data = acre %>% filter(region == "Heilongjiang"), aes(x = factor(year))) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"), group = 1)+
geom_point(aes(y = share_corn))+
geom_point(aes(y = share_rice))+
geom_point(aes(y = share_wheat))+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()
ggplot(data = acre %>% filter(region %in% c("Heilongjiang") ), aes(x = factor(year) )) +
geom_line(aes(y = share_corn, color = "corn"), group = 1)+
geom_line(aes(y = share_soy, color = "soybean"), group = 1)+
geom_line(aes(y = share_rice, color = "rice"), group = 1)+
geom_line(aes(y = share_wheat, color = "wheat"),  group = 1)+
geom_line(aes(y = share_vege, color = "vege"),  group = 1)+
geom_line(aes(y = share_fruit, color = "fruit"),  group = 1)+
xlab("Year") +
ylab("Acreage Share")+
theme_bw()+
facet_wrap(~region)+
scale_color_manual(values = c("corn" = "red",
"soybean" = "blue",
"rice" = "green",
"wheat" = "purple",
"vege" = "orange",
"fruit" = "black"))
#change detection
acre %>% filter(year %in% c(2015, 2016)) %>%
group_by(region) %>% arrange(year) %>%
summarize(soybean = (last(acre_soy)/first(acre_soy)-1)*100,
corn = (last(acre_corn)/first(acre_corn)-1)*100,
rice = (last(acre_rice)/first(acre_rice)-1)*100,
wheat = (last(acre_wheat)/first(acre_wheat)-1)*100,
vege = (last(acre_vege)/first(acre_vege)-1)*100,
fruit = (last(acre_fruit)/first(acre_fruit)-1)*100,
oil = (last(acre_oil)/first(acre_oil)-1)*100) %>%
arrange(desc(soybean))
#share change
acre %>% filter(year %in% c(2015, 2016)) %>%
group_by(region) %>% arrange(year) %>%
summarize(soybean = (last(share_soy)/first(share_soy)-1)*100,
corn = (last(share_corn)/first(share_corn)-1)*100,
rice = (last(share_rice)/first(share_rice)-1)*100,
wheat = (last(share_wheat)/first(share_wheat)-1)*100,
vege = (last(share_vege)/first(share_vege)-1)*100,
fruit = (last(share_fruit)/first(share_fruit)-1)*100,
oil = (last(share_oil)/first(share_oil)-1)*100) %>%
arrange(desc(soybean))
ggplot(data = main, aes(x = year)) +
geom_point(aes(y = share_soy, color = "soy"))+
geom_point(aes(y = share_corn, color = "corn"))+
geom_point(aes(y = share_vege, color = "vege"))+
facet_wrap(~region)
#share change per year
share_change <- main %>% arrange(region, year) %>%
group_by(region) %>%
mutate(pct_soy = (share_soy/lag(share_soy)-1)*100,
pct_corn = (share_corn/lag(share_corn)-1)*100,
pct_rice = (share_rice/lag(share_rice)-1)*100,
pct_wheat = (share_wheat/lag(share_wheat)-1)*100,
pct_vege = (share_vege/lag(share_vege)-1)*100,
pct_fruit = (share_fruit/lag(share_fruit)-1)*100,
pct_oil = (share_oil/lag(share_oil)-1)*100,
)
#corn
ggplot(data = share_change) +
geom_line(aes(x = factor(year), y = pct_corn), color = "blue", group = 1) +
geom_col(aes(x = factor(year), y = pct_corn, fill = pct_corn > 0))+
geom_point(aes(x = factor(year), y = pct_corn)) +
facet_wrap(~region)+
theme_classic() +
xlab("Year")+
ylab("% Change in Corn Share Per Year")+
scale_fill_manual(
values = c("TRUE" = "green", "FALSE" = "red"),
labels = c("Negative", "Positive"),
name = NULL
)
<<<<<<< Updated upstream
=======
multidat$share_lag <- get_lag(multidat, "share", 1, weight = 1)
multidat$share[multidat$share == 0] <- 0.1
multidat$policy <- multidat$subsidy > 0
multidat <- multidat %>%
mutate(share_wheat = multidat %>% filter(crop == "wheat") %>% "$"(share) %>%
matrix(., nrow = 21) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(y2 = log(share/(other + share_wheat)))           # y2 is the relative share
preddat <- multidat %>% filter(year == 2021)
regdat <- multidat %>% filter(year < 2021)
View(multidat)
View(multidat %>% select(region, crop, year, subsidy, subsidy_corn, subsidy_rice, subsidy_soy))
preddat <- multidat %>% filter(year == 2021)
regdat <- multidat %>% filter(year < 2021)
saveRDS(regdat, "From Hao/data/18provinces/regdat_18prov.rds")
saveRDS(preddat, "From Hao/data/18provinces/preddat_18prov.rds")
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/18provinces/regdat_18prov.rds")
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/18provinces/preddat_18prov.rds")
regdat <- rbind(regdat, preddat)
View(regdat)
lm_corn_pf <- lm(y2 ~ 0 + region + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop, data = regdat %>% filter(crop == "corn"))
summary(lm_corn_pf)
lm_soy_pf <- lm(y2 ~ 0 + region + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop, data = regdat %>% filter(crop == "soybean"))
summary(lm_soy_pf)
lm_rice_pf <- lm(y2 ~ 0 + region + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop, data = regdat %>% filter(crop == "rice"))
summary(lm_rice_pf)
library(lme4)
?lmer
glm_corn_pf <- lmer(y2 ~ 0 + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop | region, data = regdat %>% filter(crop == "corn"))
summary(glm_corn_pf)
glm_corn_pf
glm_corn_pf@resp
glm_corn_pf@Gp
glm_corn_pf@frame
glm_corn_pf@flist
library(lmerTest)
install.packages("lmerTest")
library(lmerTest)
summary(glm_corn_pf)
library(lmerTest)
glm_corn_pf <- lmer(y2 ~ 0 + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop | region, data = regdat %>% filter(crop == "corn"))
summary(glm_corn_pf)
glm_corn_pf <- lmer(y2 ~ 0 + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop | region, data = regdat %>% filter(crop == "corn")，
control = lmerControl(optimizer = "Nelder_Mead"))
glm_corn_pf <- lmer(y2 ~ 0 + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop | region, data = regdat %>% filter(crop == "corn"),
control = lmerControl(optimizer = "Nelder_Mead", optCtrl = list(maxfun = 1e5)))
glm_corn_pf <- lmer(y2 ~ 0 + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop | region, data = regdat %>% filter(crop == "corn"),
control = lmerControl(optimizer = "Nelder_Mead", optCtrl = list(maxfun = 100)))
glm_corn_pf <- lmer(y2 ~ 0 + pfex_corn + pfex_rice + pfex_soy + subsidy_corn + subsidy_rice + subsidy_soy +
stateprop | region, data = regdat %>% filter(crop == "corn"),
control = lmerControl(optimizer = "Nelder_Mead"))
summary(glm_corn_pf)
dat <- readRDS("~/Documents/Projects/Edge-of-field/dat/dat.rds")
head(dat)
dim(dat)
preddat_18prov <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/18provinces/preddat_18prov.rds")
regdat_18prov <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/18provinces/regdat_18prov.rds")
result <- rbind(regdat_18prov, preddat_18prov)
View(result)
library(tidyverse)
result %>% arrange(region, crop, year) -> newresult
View(newresult)
write.csv(newresult, "From Hao/data/18provinces/alldata.csv")
install.packages("Rcpp")
install.packages("sp")
install.packages("sf")
install.packages("inline")
install.packages("shiny")
install.packages("pander")
acre_vege <- readxl::read_xls("From Hao/rawdata/update/acre_vege.xls")
names(acre_vege) <- c("index", "region", "year", "value")
table(acre_vege$region)
acre_vege$region <- factor(acre_vege$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
head(acre_vege)
table(acre_vege$region, acre_vege$year)
head(acre_vege)
acre_vege %>%
tidyr::spread(key = index, value, -region, -year) %>%
head()
library(tidyverse)
acre_vege %>%
spread(key = index, value, -region, -year) %>%
head()
head(acre_vege
)
acre_vege$year <- as.numeric(acre_vege$year)
acre_vege$value <- as.numeric(acre_vege$value)
acre_vege %>%
spread(key = index, value, -region, -year) %>%
head()
acre_vege %>%
tidyr::spread(key, value, -region, -year) %>%
head()
acre_vege %>%
tidyr::spread(key = index, value, -region, -year) %>%
head()
acre_vege %>%
tidyr::spread(key = index, value) %>%
head()
acre_vege %>%
tidyr::spread(key = index, value) %>%
View()
acre_vege <- acre_vege %>% tidyr::spread(key = index, value)
View(acre_vege)
acre0821 <- readxl::read_xls("From Hao/rawdata/update/acre0821.xls")
head(acre0821)
source("~/.active-rstudio-document", echo=TRUE)
acre0821 <- readxl::read_xls("From Hao/rawdata/update/acre0821.xls")
names(acre0821) <- c("index", "region", "year", "value")
acre0821$region <- factor(acre0821$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
acre0821$year <- as.numeric(acre0821$year)
acre0821$value <- as.numeric(acre0821$value)
acre0821 <- acre0821 %>% tidyr::spread(key = index, value)
View(acre0821)
average_price <- readxl::read_xls("From Hao/rawdata/update/average price.xls")
head(average_price)
table(average_price$地区)
average <- readxl::read_xls("From Hao/rawdata/update/average.xls")
head(average)
table(average$地区)
cost0821 <- rbind(readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-1.xls"),
readxl::read_xls("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/rawdata/update/cost0821-2.xls"))
head(cost0821)
table(cost0821)
table(cost0821$分类)
table(cost0821$指标)
head(cost)
head(cost0821)
names(cost0821) <- c("index", "region", "crop", "year", "value")
cost0821$region <- factor(cost0821$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
cost0821$year <- as.numeric(cost0821$year)
cost0821$value <- as.numeric(cost0821$value)
head(cost0821)
cost0821 %>% tidyr::spread(key = c(crop, index), value)  %>%  head()
cost0821 %>% unite("new_key", index, crop, sep = "_") %>%
tidyr::spread(key = new_key, value)  %>%  head()
cost0821 %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)  %>%  View()
cost0821 %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)  %>%  View()
cost0821 %>% unite("new_key", crop, index, sep = "_") %>% head()
cost0821 <- cost0821 %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
View(cost0821)
costavg0821 <- readxl::read_xls("From Hao/rawdata/update/costavg0821.xls")
head(costavg0821)
table(costavg0821)
table(costavg0821$分类)
oil <- readxl::read_xls("From Hao/rawdata/update/oil.xls")
head(oil)
table(oil$分类)
names(oil) <- c("index", "region", "crop", "year", "value")
oil$region <- factor(oil$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
oil <- readxl::read_xls("From Hao/rawdata/update/oil.xls")
names(oil) <- c("index", "region", "crop", "year", "value")
oil$region <- factor(oil$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
table(oil)
table(oil$region)
head(oil)
table(crop)
table(oil$crop)
table(oil$index)
oil <- rbind(readxl::read_xls("From Hao/rawdata/update/oil_yunnan.xls"),
readxl::read_xls("From Hao/rawdata/update/oil.xls"))
names(oil) <- c("index", "region", "crop", "year", "value")
oil$region <- factor(oil$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi"))   # miss "Shanxi" and "Heilongjiang"
oil$year <- as.numeric(oil$year)
oil$value <- as.numeric(oil$value)
oil <- oil %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
oil <- rbind(readxl::read_xls("From Hao/rawdata/update/oil_yunnan.xls"),
readxl::read_xls("From Hao/rawdata/update/oil.xls"))
names(oil) <- c("index", "region", "crop", "year", "value")
oil$region <- factor(oil$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi"))   # miss "Shanxi" and "Heilongjiang"
oil$year <- as.numeric(oil$year)
oil$value <- as.numeric(oil$value)
head(oil)
oil %>% unite("new_key", crop, index, sep = "_") %>% head()
oil %>% unite("new_key", crop, index, sep = "_") -> gg
gg$new_key %>% table()
oil <- rbind(readxl::read_xls("From Hao/rawdata/update/oil_yunnan.xls"),
readxl::read_xls("From Hao/rawdata/update/oil.xls"))
names(oil) <- c("index", "region", "crop", "year", "value")
oil$region <- factor(oil$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi"))   # miss "Shanxi" and "Heilongjiang"
oil$year <- as.numeric(oil$year)
oil$value <- as.numeric(oil$value)
oil <- oil %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
orchid <- readxl::read_xls("From Hao/rawdata/update/orchid.xls")
head(orchid)
table(orchid$地区)
names(orchid) <- c("index", "region", "crop", "year", "value")
orchid <- orchid %>% filter(region!= "江西")
orchid$region <- factor(orchid$region,
labels = c("Sichuan", "Shandong", "Shanxi", "Guangxi",
"Hebei", "Henan", "Hubei", "Gansu", "Liaoning",
"Shaanxi"))   # miss "Yunnan", "Neimenggu", "Jilin", "Anhui", "Xinjiang", "Jiangsu", "Guizhou", and "Heilongjiang"
orchid$year <- as.numeric(orchid$year)
orchid$value <- as.numeric(orchid$value)
orchid <- orchid %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
View(orchid)
vege <- rbind(readxl::read_xls("From Hao/rawdata/update/vege1.xls"),
readxl::read_xls("From Hao/rawdata/update/vege2.xls"))
table(vege$指标)
table(vege$地区)
table(vege$分类)
names(vege) <- c("index", "region", "crop", "year", "value")
vege$region <- factor(vege$region,
labels = c("Yunnan", "Neimenggu", "Jilin", "Sichuan", "Anhui", "Shandong", "Shanxi", "Guangxi",
"Xinjiang", "Jiangsu", "Hebei", "Henan", "Hubei", "Gansu", "Guizhou", "Liaoning",
"Shaanxi", "Heilongjiang"))
vege$year <- as.numeric(vege$year)
vege$value <- as.numeric(vege$value)
vege <- vege %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
View(vege)
left_join(acre_vege, vege) %>% left_join(., acre0821) %>%
left_join(., cost0821) %>% left_join(., oil) %>% left_join(., orchid) %>% View()
left_join(acre_vege, vege) %>% left_join(., acre0821) %>%
left_join(., cost0821) %>% left_join(., oil) %>% left_join(., orchid) %>% dim()
province_raw <- left_join(acre_vege, vege) %>% left_join(., acre0821) %>%
left_join(., cost0821) %>% left_join(., oil) %>% left_join(., orchid)
write.csv(province_raw, "From Hao/data/rawcleandata_18/province_raw.csv")
have(average_price)
head(average_price)
names(average_price) <- c("index", "region", "crop", "year", "value")
average_price$year <- as.numeric(average_price$year)
average_price$value <- as.numeric(average_price$value)
head(average_price)
average_price <- average_price %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
head(average_price)
head(average)
table(average$分类)
average <- readxl::read_xls("From Hao/rawdata/update/average.xls")
names(average) <- c("index", "region", "crop", "year", "value")
average$year <- as.numeric(average$year)
average$value <- as.numeric(average$value)
average <- average %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
View(average)
head(costavg0821)
head(average_price)
names(average_price)
names(costavg0821)
names(costavg0821)
average_price <- readxl::read_xls("From Hao/rawdata/update/average price.xls")
costavg0821 <- readxl::read_xls("From Hao/rawdata/update/costavg0821.xls")
head(average_price)
head(costavg0821)
average <- readxl::read_xls("From Hao/rawdata/update/average.xls")
head(average)
average_price <- readxl::read_xls("From Hao/rawdata/update/average price.xls")
costavg0821 <- readxl::read_xls("From Hao/rawdata/update/costavg0821.xls")
tmp <- rbind(average_price, costavg0821)
tmp <- rbind(average_price, costavg0821)
names(tmp) <- c("index", "region", "crop", "year", "value")
tmp$year <- as.numeric(tmp$year)
tmp$value <- as.numeric(tmp$value)
tmp <- tmp %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
head(average_price)
View(average_price)
View(costavg0821)
average_price <- readxl::read_xls("From Hao/rawdata/update/average price.xls")
costavg0821 <- readxl::read_xls("From Hao/rawdata/update/costavg0821.xls")
names(tmp) <- c("index", "region", "crop", "year", "value")
tmp <- rbind(average_price, costavg0821)
tmp <- rbind(average_price, costavg0821)
names(tmp) <- c("index", "region", "crop", "year", "value")
tmp$year <- as.numeric(tmp$year)
tmp$value <- as.numeric(tmp$value)
head(tmp)
tmp %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)  %>% head()
table(tmp$crop)
table(tmp$index)
table(tmp$index, tmp$crop)
table(average_price)
table(average_price$指标
)
table(costavg0821$指标)
costavg0821 <- readxl::read_xls("From Hao/rawdata/update/costavg0821.xls")
names(costavg0821) <- c("index", "region", "crop", "year", "value")
costavg0821$year <- as.numeric(costavg0821$year)
costavg0821$value <- as.numeric(costavg0821$value)
costavg0821 <- costavg0821 %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
View(costavg0821)
readRDS("From Hao/data/heilongjiang/future_price.rds") %>%
filter(month == "03") %>% head()
fuprice <- readRDS("From Hao/data/heilongjiang/future_price.rds") %>%
filter(month == "03") %>% select(year, crop, ex_price) %>%
mutate(year = as.numeric(year))
my_fuprice <- data.frame(year = rep(2001:2021, 4),
crop = rep(c("corn", "rice", "soybean", "wheat"), each = 21)) %>%
left_join(., fuprice)
head(my_fuprice)
my_fuprice <- data.frame(year = rep(2001:2021, 4),
crop = rep(c("corn", "rice", "soybean", "wheat"), each = 21)) %>%
left_join(., fuprice) %>% spread(crop, ex_price)
head(my_fuprice)
my_fuprice <- data.frame(year = rep(2001:2021, 4),
crop = rep(c("corn", "rice", "soybean", "wheat"), each = 21)) %>%
left_join(., fuprice) %>% spread(crop, ex_price) %>%
"colnames<-"(c("year", paste(c("corn", "rice", "soybean", "wheat"), "fp", sep = "_")))
head(my_fuprice)
dim(average)
average <- readxl::read_xls("From Hao/rawdata/update/average.xls")
names(average) <- c("index", "region", "crop", "year", "value")
average$year <- as.numeric(average$year)
average$value <- as.numeric(average$value)
average <- average %>% unite("new_key", crop, index, sep = "_") %>%
tidyr::spread(key = new_key, value)
dim(average)
dim(my_fuprice)
names(costavg0821)
names(average)
price <- readxl::read_xls("From Hao/rawdata/全国平均价格.xls")
head(price)
left_join(costavg0821, my_fuprice) %>% left_join(., average) %>% View()
national_raw <- left_join(costavg0821, my_fuprice) %>% left_join(., average) %>% View()
national_raw <- left_join(costavg0821, my_fuprice) %>% left_join(., average)
write.csv(national_raw, "From Hao/data/rawcleandata_18/national_raw.csv")
# now we want to use 18 different provinces
library(tidyverse)
setwd("/Users/sunhao/Documents/GitHub/ChinaAg/")
source("From Hao/functions/get_lag.R")
### Data 3: Future Price ####
fuprice <- readRDS("From Hao/data/heilongjiang/future_price.rds") %>%
filter(month == "03") %>% select(year, crop, ex_price) %>%
mutate(year = as.numeric(year))
my_fuprice <- data.frame(year = rep(2001:2021, 4),
crop = rep(c("corn", "rice", "soybean", "wheat"), each = 21)) %>%
left_join(., fuprice)
View(fuprice)
regdat_V4 <- readRDS("~/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat_V4.rds")
Vie(regdat_V4)
View(regdat_V4)
>>>>>>> Stashed changes
