library(lme4)
lm_corn_rand <- lmer(y ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "corn"))
lm_rice_rand <- lmer(y ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "rice"))
lm_soy_rand <- lmer(y ~  pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rand <- lmer(y ~ 0 + pfex_corn + pfex_rice + pfex_soy + pfex_wheat + profit_true_lag + (1|region),
data = regdat %>% filter(crop == "wheat"))
pd_corn_rand <- predict(lm_corn_rand, newdata = preddat %>% filter(crop == "corn"))
pd_rice_rand <- predict(lm_rice_rand, newdata = preddat %>% filter(crop == "rice"))
pd_soy_rand <- predict(lm_soy_rand, newdata = preddat %>% filter(crop == "soybean"))
pd_wheat_rand <- predict(lm_wheat_rand, newdata = preddat %>% filter(crop == "wheat"))
y_pred_rand <- rbind(pd_corn_rand, pd_rice_rand, pd_soy_rand, pd_wheat_rand)
share_est_rand <- round(sweep(exp(y_pred_rand), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_rand)) + 1) * 100, 2)
share_est_rand
# Use SUR Regression
library(systemfit)
library(lme4)
cor(cbind(lm_corn$residuals, lm_rice$residuals, lm_soy$residuals, lm_wheat$residuals))
# seems that corn and rice should be together
regdat_final <- regdat %>%
mutate(
# regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
#                   lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
#   as.vector() %>% rep(., each = 20)
regionest = rbind(ranef(lm_corn_rand) %>% unlist(), ranef(lm_rice_rand) %>% unlist(),
ranef(lm_soy_rand) %>% unlist(), ranef(lm_wheat_rand) %>% unlist()) %>%
as.vector() %>% rep(., each = 20)
) %>%
mutate(y = y - regionest) %>%   # remove the region est
mutate(y_corn = regdat %>% filter(crop == "corn") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_rice = regdat %>% filter(crop == "rice") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_soy = regdat %>% filter(crop == "soybean") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
y_wheat = regdat %>% filter(crop == "wheat") %>% "$"(y) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pftrue_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_true_lag) %>% matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
filter(crop == "corn")
eq_corn <- y_corn ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_corn   # + pftrue_corn
eq_rice <- y_rice ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_rice
eq_soy <- y_soy ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_soy
eq_wheat <- y_wheat ~ pfex_corn + pfex_rice + pfex_soy + pfex_wheat + pftrue_wheat
system <- list(corn = eq_corn, rice = eq_rice, soy = eq_soy, wheat = eq_wheat)
fitsur <- systemfit( system, "SUR", data = regdat_final, maxit = 10)
preddat_final <- preddat %>%
mutate(
# regionest = rbind(lm_corn$coefficients[-(1:5)], lm_rice$coefficients[-(1:5)],
#                   lm_soy$coefficients[-(1:5)], lm_wheat$coefficients[-(1:5)]) %>%
#   as.vector()
regionest = rbind(ranef(lm_corn_rand) %>% unlist(), ranef(lm_rice_rand) %>% unlist(),
ranef(lm_soy_rand) %>% unlist(), ranef(lm_wheat_rand) %>% unlist()) %>%
as.vector()
)
surcoef <- fitsur$coefficients %>% matrix(., ncol = 4)  %>% "[" (c(2:6, 1), ) # col = crop
preddat_final$y_est <- 0
for(i in 1:nrow(preddat_final))
{
id <- which(unique(preddat_final$crop) == preddat_final$crop[i])
preddat_final$y_est[i] <- preddat_final$pfex_corn[i] * surcoef[1, id] + preddat_final$pfex_rice[i] * surcoef[2, id] +
preddat_final$pfex_soy[i] * surcoef[3, id] + preddat_final$pfex_wheat[i] * surcoef[4, id] +
preddat_final$profit_true_lag[i] * surcoef[5, id] + preddat_final$regionest[i] + surcoef[6, id]
}
y_pred_sur <- preddat_final$y_est %>% matrix(., nrow = 4)
share_est_sur <- round(sweep(exp(y_pred_sur), MARGIN = 2, FUN = "/", STATS = colSums(exp(y_pred_sur)) + 1) * 100, 2)
share_est_sur
surcoef
fitsur
lm_corn <- lm(y ~ 0 # + yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
lm_corn <- lm(y ~ 0 + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + pfex_corn + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + pfex_corn, # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
# region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + profit_true_lag + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
names(region)
names(regdat)
lm_corn <- lm(y ~ 0 + profit_ex_lag + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
names(region)
names(regdat)
lm_corn <- lm(y ~ 0 + pftrlag_corn + pftrlag_rice + # yield_lag + subsidy_lag + profit_true_lag +
# pfex_rice + pfex_soy + pfex_wheat +
region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
View(regdat)
ggplot(aes(x = pftrlag_corn, y = share), data = regdat) + geom_point()
ggplot(aes(x = pftrlag_corn, y = share), data = regdat) + geom_point() + facet_wrap(~region, nrow = 2)
483.4 * (0.9098 - 0.833889)
483.4 * (1.18157 - 0.833889)
ggplot(aes(x = pftrlag_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = yield_lag * ex_price + subsidy_lag, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
facet_wrap(~region, nrow = 2, scales = "free_y")
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector())
ggplot(aes(x = revex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
facet_wrap(~region, nrow = 2, scales = "free_y")
lm_corn <- lm(y ~ 0 + pftrlag_corn + pftrlag_rice + region,
data = regdat %>% filter(crop == "corn"))
lm_corn <- lm(y ~ 0 + pfex_corn + region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
lm_corn <- lm(y ~ 0 + revex_corn + region,
data = regdat %>% filter(crop == "corn"))
summary(lm_corn)
ggplot(aes(x = pftrlag_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth() +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = pfex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth() +
facet_wrap(~region, nrow = 2, scales = "free_y")
?geom_smooth
ggplot(aes(x = pfex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = pfex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = log(revex_corn), y = share), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "corn")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
names(regdat)
lm_corn_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + profit_true_lag + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
lm_corn_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
lm(y ~ 0 +  revex_wheat + region,
data = regdat %>% filter(crop == "wheat")) %>% summary()
lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "wheat"))
lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "wheat")) %>% summary()
lm_corn_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn/revex_wheat + revex_rice/revex_wheat + revex_soy/revex_wheat + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
# use OLS regression
library(tidyverse)
regdat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/regdat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
preddat <- readRDS("/Users/sunhao/Documents/GitHub/ChinaAg/From Hao/data/dongbei/preddat.rds") %>%
mutate(ex_revenue = yield_lag * ex_price + subsidy_lag)
# true share:
share_true <- preddat$share %>% matrix(., nrow = 4)
# add expected profit for each crop
regdat <- regdat %>%
mutate(pfex_corn = regdat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = regdat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = regdat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 20) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = regdat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = regdat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = regdat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = regdat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 20) %>%
kronecker(rep(1, 4), .) %>% as.vector())%>%
mutate(rr_corn = revex_corn/revex_wheat,
rr_rice = revex_rice/revex_wheat,
rr_soy = revex_soy/revex_wheat)
# same for the predicted data
preddat <- preddat %>%
mutate(pfex_corn = preddat %>% filter(crop == "corn") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_rice = preddat %>% filter(crop == "rice") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% # "+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_soy = preddat %>% filter(crop == "soybean") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
pfex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(profit_ex) %>%
matrix(., nrow = 1) %>% #"+"(400) %>% log() %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_corn = preddat %>% filter(crop == "corn") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_rice = preddat %>% filter(crop == "rice") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_soy = preddat %>% filter(crop == "soybean") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector(),
revex_wheat = preddat %>% filter(crop == "wheat") %>% "$"(ex_revenue) %>%
matrix(., nrow = 1) %>%
kronecker(rep(1, 4), .) %>% as.vector()) %>%
mutate(rr_corn = revex_corn/revex_wheat,
rr_rice = revex_rice/revex_wheat,
rr_soy = revex_soy/revex_wheat)
lm_corn_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rr)
summary(lm_rice_rr)
summary(lm_soy_rr)
summary(lm_wheat_rr)
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "rice")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_rice, y = log(share)), data = regdat %>% filter(crop == "rice")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
?facet_wrap
ggplot(aes(x = revex_rice, y = log(share)), data = regdat %>% filter(crop == "rice")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free")
ggplot(aes(x = revex_corn, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_soy, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free_y")
ggplot(aes(x = revex_soy, y = log(share)), data = regdat %>% filter(crop == "soybean")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free")
ggplot(aes(x = revex_wheat, y = log(share)), data = regdat %>% filter(crop == "wheat")) + geom_point() +
geom_smooth(method = "lm") +
facet_wrap(~region, nrow = 2, scales = "free")
lm_corn_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat  + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat  + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rev <- lm(y ~ 0 + revex_corn + revex_rice + revex_soy + revex_wheat  + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rev)
summary(lm_rice_rev)
summary(lm_soy_rev)
summary(lm_wheat_rev)
lm_corn_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "corn"))
lm_rice_rr <- lm(y ~ 0 + rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "rice"))
lm_soy_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "soybean"))
lm_wheat_rr <- lm(y ~ 0 +  rr_corn + rr_rice + rr_soy + region,
data = regdat %>% filter(crop == "wheat"))
summary(lm_corn_rr)
summary(lm_rice_rr)
summary(lm_soy_rr)
summary(lm_wheat_rr)
